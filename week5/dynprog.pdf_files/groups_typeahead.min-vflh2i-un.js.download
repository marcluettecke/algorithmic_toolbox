define(["require","exports","tslib","react","modules/core/i18n","modules/clean/viewer","spectrum/typeahead","dig-components/icons/src","dig-components/typography","dig-components/icons","modules/clean/api_v2/default_team_client","modules/clean/react/css","modules/clean/teams/admin/widgets/groups/create_group_modal"],(function(e,r,t,n,u,o,a,i,s,c,p,d,g){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),n=t.__importStar(n);var _={group_name:u._("Create new group"),group_id:"",group_management_type:{".tag":"other"}},m=function(e){var r=e.token,t=e.query;return r===_?n.default.createElement("div",{className:"create-new-group"},n.default.createElement(c.UIIcon,{className:"middle-align",src:i.AddCircleFill}),n.default.createElement(s.Text,null,t?u.intl.formatMessage(u._('Create "%(group_name)s"'),{group_name:t}):r.group_name)):n.default.createElement(s.Text,null,r.group_name)};r.fetchGroups=function(e){return void 0===e&&(e=!0),t.__awaiter(void 0,void 0,void 0,(function(){return t.__generator(this,(function(r){switch(r.label){case 0:return[4,new p.DefaultTeamApiV2Client(o.Viewer.get_viewer().work_user).ns("team").rpc("groups/list",{limit:1e3},{}).then((function(r){if(!e)return r.groups;var t=r.groups.reduce((function(e,r){return"system_managed"===r.group_management_type[".tag"]&&(r.member_count||0)>(e.member_count||0)?r:e})).group_id;return r.groups.filter((function(e){return e.group_id!==t}))}))];case 1:return[2,r.sent()]}}))}))},r.groupExists=function(e,r){return e.some((function(e){return e.group_name.toLocaleLowerCase()===r.toLocaleLowerCase()}))},r.GroupsTypeahead=d.requireCssWithComponent((function(e){var o=e.groups,i=e.options,s=e.onChange,c=e.onCreate,p=e.handleCreateModal,d=n.useState(!1),l=d[0],f=d[1],h=n.useState(),v=h[0],y=h[1],w=n.useState([]),C=w[0],E=w[1],x=n.useState([]),A=x[0],b=x[1];n.useEffect((function(){null==p||p(l)}),[l]),n.useEffect((function(){i?E((function(e){return t.__spreadArrays(e,i)})):r.fetchGroups().then((function(e){e.length&&E((function(r){return t.__spreadArrays(r,e)}))}))}),[]),n.useEffect((function(){return L()}),[C,o]);var L=function(e){y(e),b(t.__spreadArrays([_],C.reduce((function(r,t){return o.find((function(e){return e.group_name===t.group_name}))?r:(e?t.group_name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1&&r.push(t):r.push(t),r)}),[])))},k=function(e){s(t.__spreadArrays(o,[{group_name:e,group_id:e+"-invalid",group_management_type:{".tag":"other"},variant:"error"}])),y(void 0)};return n.default.createElement(a.Typeahead,{height:200,listItemHeight:32,className:"groups-typeahead",inputProps:{placeholder:u._("Add a group"),onBlur:function(){return v&&k(v)}},onChange:L,onRemoveToken:function(e){return s(o.filter((function(r){return r.group_name!==e.group_name})))},onSelect:function(e,n,u){if(e===_){if(!u)return void f(!0);r.groupExists(C,u)||g.createGroup(u).then((function(e){var r={group_id:e.group_id,group_name:e.group_name,group_external_id:e.group_external_id,group_management_type:e.group_management_type,member_count:e.member_count};null==c||c(r),E((function(e){return t.__spreadArrays(e,[r])})),s(t.__spreadArrays(o,[r]))})).catch((function(e){return k(u)})),y(void 0)}var a=C.find((function(r){return r.group_id===e.group_id}));a&&s(t.__spreadArrays(o,[a]))},renderSuggestion:function(e){return n.default.createElement(m,{token:e,query:v})},renderTokenContent:function(e){return n.default.createElement(n.default.Fragment,null,e.group_name)},suggestions:A,tokens:o.map((function(e){return{key:e.group_id,variant:e.variant||"default",content:e}}))})}),["/static/css/spectrum/index.web-vfl_-DzRS.css","/static/css/dig-components/index.web-vflm0_tak.css","/static/css/teams/admin/widgets/groups/groups_typeahead-vflMuYl5S.css"])}));
//# sourceMappingURL=groups_typeahead.min.js-vflY3jbAj.map