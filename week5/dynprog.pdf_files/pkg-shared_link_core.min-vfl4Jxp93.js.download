define("modules/clean/react/file_sidebar/generic_file_sidebar_provider",["require","exports","tslib","react","react-redux","modules/clean/react/file_sidebar/file_sidebar_connect","modules/clean/react/file_sidebar/store/instance"],(function(e,t,r,n,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n);var s=a.createProvider(i.FILE_SIDEBAR_REDUX_STORE_KEY),c=(function(e){function t(t){var r=e.call(this,t)||this;return r.state={loaded:!0,store:o.store},r}return r.__extends(t,e),t.prototype.render=function(){return n.default.createElement(s,{store:this.state.store},this.props.children)},t})(n.default.Component);t.GenericFileSidebarProvider=c})),define("modules/clean/react/file_sidebar/file_sidebar_provider",["require","exports","tslib","react","modules/clean/react/file_sidebar/generic_file_sidebar_provider","modules/clean/react/file_sidebar/store/instance"],(function(e,t,r,n,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(t){var r=e.call(this,t)||this;return r.state={loaded:!0,store:i.store},r}return r.__extends(t,e),t.prototype.componentWillUnmount=function(){var e=this.state.store;e&&e.dispatch({type:"::RESET"})},t.prototype.render=function(){return n.default.createElement(a.GenericFileSidebarProvider,null,this.props.children)},t})((n=r.__importDefault(n)).default.Component);t.FileSidebarProvider=o})),define("modules/clean/react/comments2/data/store",["require","exports","tslib","external/lodash","modules/clean/redux/namespaces","modules/clean/react/comments2/data/reducer","modules/clean/redux/store"],(function(e,t,r,n,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.getStoreForComments2=n.once((function(){var e;return o.getStoreAndRegisterReducers(((e={})[a.COMMENTS2_NAMESPACE_KEY]=i.reducer,e))}))})),define("modules/clean/react/file_sidebar/store/instance",["require","exports","tslib","redux","modules/clean/react/file_sidebar/store/app/reducer","modules/clean/react/file_sidebar/store/file_activity/reducer","modules/clean/react/file_sidebar/store/sidebar/reducer","modules/clean/react/file_sidebar/store/middleware/thunk","modules/clean/react/file_sidebar/store/middleware/reactor","modules/clean/react/file_sidebar/store/sidebar/reactors","modules/clean/redux/unsupported","modules/clean/redux/devtools"],(function(e,t,r,n,a,i,o,s,c,l,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(n=r.__importStar(n)).combineReducers({app:a.reducer,fileActivity:i.reducer,sidebar:o.reducer});function m(e,t){return"::RESET"===t.type&&(e=void 0),p(e,t)}t.store=u.createStore(m,d.composeEnhancersWithDevTools(n.applyMiddleware(s.thunk(),c.reactor(l.reactors))))})),define("modules/clean/react/watermarking/apply_watermark_button",["require","exports","tslib","react","modules/core/browser","modules/core/i18n","spectrum/popover","spectrum/button","premium-workflows/components/trial/trial_popover_content","modules/clean/loggers/workflows_logger","spectrum/tooltip"],(function(e,t,r,n,a,i,o,s,c,l,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),a=r.__importStar(a);var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClickedTrialPopover=function(){l.logWorkflowsEvent(l.WorkflowsEvent.WatermarkUpsellPopoverClickedWmCopy,t.props.milestone),a.redirect(t.getLink("?_tk=watermarking_popover_wm_upsell"))},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.isPopoverTrialVariant()&&l.logWorkflowsEvent(l.WorkflowsEvent.WatermarkUpsellPopoverExposedWmCopy,this.props.milestone)},t.prototype.getLink=function(e){return this.props.isPlusUser?"/buy"+e:"/pro/try"+e},t.prototype.isPopoverTrialVariant=function(){var e=this.props,t=e.allowWatermark,r=e.trialVariant;return!t&&"POPOVER_WM_VALUE_PROPS"===r},t.prototype.renderPopoverContent=function(){return this.isPopoverTrialVariant()?n.default.createElement(o.PopoverContent,null,n.default.createElement(c.TrialPopoverContent,{variant:"watermarking_wm",onClick:this.onClickedTrialPopover})):n.default.createElement(o.PopoverContent,null,n.default.createElement(o.PopoverContentItem,{value:!1,className:"apply-watermark-menu-item__copy"},i._("Make a copy",{comment:"As in: save the watermarked file as a copy"})),n.default.createElement(o.PopoverContentItem,{value:!0,className:"apply-watermark-menu-item__overwrite"},i._("Replace original",{comment:"As in: overwrite this file with watermarked file"})))},t.prototype.renderButton=function(){var e=this.props,t=e.onClick,r=e.hasInput,a=n.default.createElement(s.Button,{className:"apply-watermark-button",tagName:"div",disabled:!r,variant:"primary",onClick:t},i._("Save"));return r?a:n.default.createElement(u.Tooltip,{className:"watermarking-save-bubble--no-watermark",tooltipContent:i._("Add an image or text watermark to save",{comment:"As in: notifying user they cannot save watermark if no image uploaded or text set"}),positioning:"below"},a)},t.prototype.render=function(){var e=this.props.hasInput;return n.default.createElement(o.Popover,{onSelection:this.props.onApply},n.default.createElement(o.PopoverTrigger,{disabled:!e},this.renderButton()),this.renderPopoverContent())},t})(n.default.Component);t.ApplyWatermarkButton=d})),define("modules/clean/react/file_sidebar/store/sidebar/actions",["require","exports","tslib","modules/clean/react/file_sidebar/store/file_activity/selectors","modules/clean/react/file_sidebar/store/sidebar/helpers","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/types","file-viewer/core"],(function(e,t,r,n,a,i,o,s,c){"use strict";function l(e){return function(t,r){t({type:s.ActionType.SidebarOpen,payload:{reason:e}})}}function u(){return function(e,t){var r=t(),a=i.getSidebarContext(r).user;i.getSidebarState(r).open&&(e({type:s.ActionType.SidebarClose}),o.logSidebarClosed({num_comments:i.getTabState(r,"comments").extra.commentCount,num_events:n.getVisibleActivityCount(r),viewing_user_id:a?a.id:null}))}}function d(){return{type:s.ActionType.SidebarIndicateNewFileNav}}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),a=r.__importStar(a),i=r.__importStar(i),t.reset=function(){return{type:s.ActionType.SidebarReset}},t.open=l,t.close=u,t.toggle=function(){return function(e,t){var r=t();i.getSidebarState(r).open?e(u()):e(l("toggle_button"))}},t.completeToggleOpen=function(){return function(e){e(l("toggle_button_after_transition"))}},t.selectTab=function(e){return{type:s.ActionType.SidebarSelectTab,payload:{tabName:e}}},t.thirdpartyBlueDotOnboard=function(){return{type:s.ActionType.SidebarSetThirdPartyBlueDotOnboardState}},t.openFile=function(e){return function(t,r){var n=r(),o=i.getSidebarContext(n);a.isContextChanged(o,e)&&(t({type:s.ActionType.SidebarOpenFile,payload:e}),t(d()))}},t.setComments2DisabledState=function(){return{type:s.ActionType.SidebarSetComments2DisabledState}},t.setComments2ShownState=function(e){return{type:s.ActionType.SidebarSetComments2ShownState,payload:e}},t.setCommentingOnNewFile=d,t.OverrideInitialState=function(e){var t=e===c.FileViewerMode.Documentation?"metadata":"comments";return{type:s.ActionType.SidebarOverrideInitialState,payload:{open:!0,tab:t}}}})),define("modules/clean/react/comments2/data/reducer",["require","exports","tslib","external/lodash","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/initial_state","modules/clean/react/comments2/data/util","modules/clean/react/comments2/data/reducer_helper","modules/clean/react/comments2/data/types","comments2/transforms"],(function(e,t,r,n,a,i,o,s,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),l=r.__importStar(l);var u=s.createStatusReducer(a.ActionTypes),d=s.createActionReducer(),p=s.createReducerFrom(d(a.ActionTypes.SetContext,(function(e,t){return t?r.__assign(r.__assign({},t),{status:c.Comments2ContextStatus.Pending}):void 0})),d(a.ActionTypes.SetContextStatus,(function(e,t){return r.__assign(r.__assign({},e),{status:t})})));function m(e,t,r){return e.map((function(e){return e.id===t?r(e):e}))}function _(e,t,a){var i=e.threads[t];return i?(function(e,t){var n;return r.__assign(r.__assign({},e),{threads:r.__assign(r.__assign({},e.threads),(n={},n[t.id]=t,n))})})(e,n.assignIn({},i,a)):e}function g(e,t,n,a){var i,o=t.threads[n];return o?_(t,n,o.pending?r.__assign(r.__assign({},o),((i={})[a]=o.pending.originalValue,i.pending=r.__assign(r.__assign({},o.pending),{error:e}),i)):o):t}function f(e,t,r,n){var a=e.threads[r];return a?_(e,r,{comments:m(a.comments,t,n)}):e}function v(e,t,n,a,i){return f(t,n,a,(function(t){var n;return t.pending?r.__assign(r.__assign({},t),((n={})[i]=t.pending.originalValue,n.pending=r.__assign(r.__assign({},t.pending),{error:e}),n)):t}))}var h=s.createActionReducer(),w=s.createReducerFrom(h(a.ActionTypes.ActivateThread,(function(e,t){var n=t.thread,a=t.pendingAnnotationInfo,i=t.wasPreviewLayerClick;return r.__assign(r.__assign({},e),{activatedThreadId:n.id,documentRectangleToMakeVisible:i?void 0:o.documentRectangleFromThread(n),pendingAnnotationInfo:a||e.pendingAnnotationInfo})})),h(a.ActionTypes.DeactivateAllThreads,(function(e){return n.assignIn({},e,{activatedThreadId:void 0,activatedDocumentAnnotationRectangle:void 0})})),h(a.ActionTypes.ListComments,{Success:function(e,t,n){var a=r.__assign(r.__assign({},e.authors),l.usersToIUserMap(t.authors)),i=r.__assign(r.__assign({},e.threads),l.threadsToIThreadMap(t.threads,a,t.currentRevision));return r.__assign(r.__assign({},e),{threads:i,authors:a,cursor:t.cursor,listCommentsError:void 0})},Error:function(e,t,n){return r.__assign(r.__assign({},e),{listCommentsError:t})}}),h(a.ActionTypes.CreateThread,{Request:function(e,t,n){var i,s=new Date,c=n.annotation,l=n.author,u=n.content,d=n.guid,p={id:d,timestamp:s,read:!0,readonly:!0,isShownInBrowseSurface:!1,isThirdParty:!1,resolved:!1,comments:[{id:d,threadId:d,timestamp:s,author:l,content:u,revisionInfo:{isCurrent:!0},userPermissions:{canDelete:!1,canEdit:!1}}],annotation:c},m=r.__assign(r.__assign({},p),{pending:{action:a.ActionTypes.CreateThread.name,originalValue:void 0,pendingValue:p}}),_=e.pendingAnnotationInfo.annotationMayBeOffscreen?o.documentRectangleFromThread(p):void 0;return r.__assign(r.__assign({},e),{activatedThreadId:d,documentRectangleToMakeVisible:_,threads:r.__assign(r.__assign({},e.threads),(i={},i[d]=m,i))})},Success:function(e,t,n){var a,i=n.guid,o=e.threads,s=i,c=o[s],l=r.__rest(o,["symbol"==typeof s?s:s+""]),u=m(c.comments,i,(function(e){return r.__assign(r.__assign({},e),{id:t.id,userPermissions:{canDelete:!0,canEdit:!(e.content.metadata[0]&&"sticker"===e.content.metadata[0].type)},readonly:!1})}));return r.__assign(r.__assign({},e),{activatedThreadId:e.activatedThreadId===n.guid?t.id:e.activatedThreadId,threads:r.__assign(r.__assign({},l),(a={},a[t.id]=r.__assign(r.__assign({},c),{id:t.id,comments:u,pending:void 0}),a))})},Error:function(e,t,n){var a=e.threads,i=n.guid,o=(a[i],r.__rest(a,["symbol"==typeof i?i:i+""]));return r.__assign(r.__assign({},e),{threads:o})}}),h(a.ActionTypes.ReplyToThread,{Request:function(e,t,n){var i,o=new Date,s=n.author,c=n.content,l=n.guid,u=n.threadId,d={id:l,threadId:u,timestamp:o,author:s,content:c,revisionInfo:{isCurrent:!0},userPermissions:{canDelete:!1,canEdit:!1}},p=e.threads[u],m=r.__assign(r.__assign({},p),{read:!0,comments:r.__spreadArrays(p.comments,[d])}),_=r.__assign(r.__assign({},m),{pending:{action:a.ActionTypes.ReplyToThread.name,originalValue:p,pendingValue:m}});return r.__assign(r.__assign({},e),{activatedThreadId:u,threads:r.__assign(r.__assign({},e.threads),(i={},i[u]=_,i))})},Success:function(e,t,n){var a,i=n.guid,o=n.threadId,s=e.threads[o],c=m(s.comments,i,(function(e){return r.__assign(r.__assign({},e),{id:t.id,userPermissions:{canDelete:!0,canEdit:!(e.content.metadata[0]&&"sticker"===e.content.metadata[0].type)}})}));return r.__assign(r.__assign({},e),{threads:r.__assign(r.__assign({},e.threads),(a={},a[o]=r.__assign(r.__assign({},s),{comments:c,pending:void 0}),a))})},Error:function(e,t,n){var a,i=e.threads[n.threadId],o=i.comments.filter((function(e){return e.id!==n.guid}));return r.__assign(r.__assign({},e),{threads:r.__assign(r.__assign({},e.threads),(a={},a[n.threadId]=r.__assign(r.__assign({},i),{comments:o,pending:void 0}),a))})}}),h(a.ActionTypes.DeleteComment,{Request:function(e,t,n){return f(e,n.commentId,n.threadId,(function(e){return r.__assign(r.__assign({},e),{deleted:!0,pending:{action:a.ActionTypes.DeleteComment.name,originalValue:e.deleted,pendingValue:!0}})}))},Success:function(e,t,n){return f(e,n.commentId,n.threadId,(function(e){return r.__assign(r.__assign({},e),{pending:void 0})}))},Error:function(e,t,r){return v(t,e,r.commentId,r.threadId,"deleted")}}),h(a.ActionTypes.EditComment,{Request:function(e,t,n){return f(e,n.commentId,n.threadId,(function(e){return r.__assign(r.__assign({},e),{content:n.content,pending:{action:a.ActionTypes.EditComment.name,originalValue:e.content,pendingValue:n.content}})}))},Success:function(e,t,n){return f(e,n.commentId,n.threadId,(function(e){return r.__assign(r.__assign({},e),{pending:void 0})}))},Error:function(e,t,r){return v(t,e,r.commentId,r.threadId,"content")}}),h(a.ActionTypes.SetPerfData,(function(e,t){return r.__assign(r.__assign({},e),{perfEvents:r.__assign(r.__assign({},e.perfEvents),t)})})),h(a.ActionTypes.CheckOnboardingStatus,(function(e,t){return r.__assign(r.__assign({},e),{onboardingVariants:{premium_av_comments_pane_surface:!1===t.premium_av_comments_pane_surface,premium_av_preview_surface:!1===t.premium_av_preview_surface,non_premium_av_comments_pane_surface:!1===t.non_premium_av_comments_pane_surface,not_annotatable_file_comments_pane_surface:!1===t.not_annotatable_file_comments_pane_surface,how_to_at_mention_comments_pane_surface:!1===t.how_to_at_mention_comments_pane_surface,image_preview_surface:!1===t.image_preview_surface,document_preview_surface:!1===t.document_preview_surface,share_as_comment:!1===t.share_as_comment}})})),h(a.ActionTypes.MarkOnboarded,(function(e,t,n){var a;return r.__assign(r.__assign({},e),{onboardingVariants:r.__assign(r.__assign({},e.onboardingVariants),(a={},a[n]=!1,a))})})),h(a.ActionTypes.MarkModalVariantShown,(function(e,t){var n;return r.__assign(r.__assign({},e),{modalVariantsShown:r.__assign(r.__assign({},e.modalVariantsShown),(n={},n[t]=!0,n))})})),h(a.ActionTypes.DismissOnboarding,(function(e){return r.__assign(r.__assign({},e),{onboardingVariants:n.mapValues(e.onboardingVariants,(function(){return!1}))})})),h(a.ActionTypes.MarkThreadRead,{Request:function(e,t,r){return _(e,r.threadId,{read:!0,pending:{action:a.ActionTypes.MarkThreadRead.name,originalValue:e.threads[r.threadId].read,pendingValue:!0}})},Success:function(e,t,r){return _(e,r.threadId,{pending:void 0})},Error:function(e,t,r){return g(t,e,r.threadId,"read")}}),h(a.ActionTypes.MarkThreadUnread,{Request:function(e,t,r){return _(e,r,{read:!1,pending:{action:a.ActionTypes.MarkThreadUnread.name,originalValue:e.threads[r].read,pendingValue:!1}})},Success:function(e,t,r){return _(e,r,{pending:void 0})},Error:function(e,t,r){return g(t,e,r,"read")}}),h(a.ActionTypes.MarkThreadResolved,{Request:function(e,t,r){var n={type:"with_details",resolver:r.resolver,resolvedTimestamp:new Date};return _(e,r.threadId,{resolvedInfo:n,pending:{action:a.ActionTypes.MarkThreadResolved.name,originalValue:e.threads[r.threadId].resolvedInfo,pendingValue:n}})},Success:function(e,t,r){return _(e,r.threadId,{pending:void 0})},Error:function(e,t,r){return g(t,e,r.threadId,"resolvedInfo")}}),h(a.ActionTypes.MarkThreadUnresolved,{Request:function(e,t,r){return _(e,r,{resolvedInfo:void 0,pending:{action:a.ActionTypes.MarkThreadUnresolved.name,originalValue:e.threads[r].resolvedInfo,pendingValue:void 0}})},Success:function(e,t,r){return _(e,r,{pending:void 0})},Error:function(e,t,r){return g(t,e,r,"resolvedInfo")}}),h(a.ActionTypes.SetContext,(function(e,t){return r.__assign(r.__assign({},e),n.pick(i.INITIAL_STATE.data,"activatedThreadId","authors","cursor","documentMetadata","enabledStatus","pendingAnnotationInfo","playerIntegrationEnabled","requestEditorFocus","canSeeCommentEditor","subscriptionStatus","threads"))})),h(a.ActionTypes.ToggleShowResolved,(function(e){return r.__assign(r.__assign({},e),{showResolved:!e.showResolved})})),h(a.ActionTypes.UpdateEditorIsEmpty,(function(e,t){return r.__assign(r.__assign({},e),{editorIsEmpty:t})})),h(a.ActionTypes.UpdateDocumentCurrentPage,(function(e,t){return r.__assign(r.__assign({},e),{pendingAnnotationInfo:r.__assign(r.__assign({},e.pendingAnnotationInfo),{currentPageNumber:t})})})),h(a.ActionTypes.UpdatePlayerCurrentTime,(function(e,t){return r.__assign(r.__assign({},e),{pendingAnnotationInfo:r.__assign(r.__assign({},e.pendingAnnotationInfo),{playerCurrentTime:t})})})),h(a.ActionTypes.HoverThread,(function(e,t){return r.__assign(r.__assign({},e),{hoverThreadId:t})})),h(a.ActionTypes.FocusThread,(function(e,t){return r.__assign(r.__assign({},e),{focusedThreadId:t})})),h(a.ActionTypes.SetPendingNumberedAnnotation,(function(e,t){return r.__assign(r.__assign({},e),{pendingAnnotationInfo:r.__assign(r.__assign({},e.pendingAnnotationInfo),{numberedAnnotation:t,annotationMayBeOffscreen:!1})})})),h(a.ActionTypes.ClearPendingNumberedAnnotation,(function(e,t){return r.__assign(r.__assign({},e),{pendingAnnotationInfo:r.__assign(r.__assign({},e.pendingAnnotationInfo),{numberedAnnotation:void 0,annotationMayBeOffscreen:!1})})})),h(a.ActionTypes.SetPendingNumberedAnnotationMayBeOffscreen,(function(e){return r.__assign(r.__assign({},e),{pendingAnnotationInfo:r.__assign(r.__assign({},e.pendingAnnotationInfo),{annotationMayBeOffscreen:!0})})})),h(a.ActionTypes.TrackSidebarCommentsVisibility,(function(e,t){return r.__assign(r.__assign({},e),{visibleInSidebar:t})})),h(a.ActionTypes.DocMetadataLoad,(function(e,t){return r.__assign(r.__assign({},e),{documentMetadata:t})})),h(a.ActionTypes.RequestEditorFocus,(function(e){return r.__assign(r.__assign({},e),{requestEditorFocus:!0})})),h(a.ActionTypes.FulfillEditorFocusRequest,(function(e){if(!e.requestEditorFocus)throw new Error("Fulfilling request for editor focus, but isnt requested in store");return r.__assign(r.__assign({},e),{requestEditorFocus:!1})})),h(a.ActionTypes.EnablePlayerIntegration,(function(e,t){return r.__assign(r.__assign({},e),{playerIntegrationEnabled:!0})})),h(a.ActionTypes.SetUpsellTooltipVariant,(function(e,t){return r.__assign(r.__assign({},e),{upsellTooltipVariant:t})})),h(a.ActionTypes.SetThirdPartySource,(function(e,t){return r.__assign(r.__assign({},e),{thirdPartySource:t})})),h(a.ActionTypes.SetCanSeeCommentEditor,(function(e,t){return r.__assign(r.__assign({},e),{canSeeCommentEditor:t})})),h(a.ActionTypes.RecordEnabledStatus,(function(e,t){return r.__assign(r.__assign({},e),{enabledStatus:n.merge({},e.enabledStatus,t)})})),h(a.ActionTypes.SetSubscriptionStatus,(function(e,t){return r.__assign(r.__assign({},e),{subscriptionStatus:t})})),h(a.ActionTypes.Subscribe,(function(e){return r.__assign(r.__assign({},e),{subscriptionStatus:n.merge({},e.subscriptionStatus,{isSubscribed:!0})})})),h(a.ActionTypes.Unsubscribe,(function(e){return r.__assign(r.__assign({},e),{subscriptionStatus:n.merge({},e.subscriptionStatus,{isSubscribed:!1})})})),h(a.ActionTypes.ResetStore,(function(e,t){return r.__assign({},i.INITIAL_STATE.data)})),h(a.ActionTypes.GetStickers,(function(e,t){return r.__assign(r.__assign({},e),{stickers:t.sticker_sets})})));t.reducer=function(e,t){void 0===e&&(e=i.INITIAL_STATE);var r=p(e.context,t),n=w(e.data,t),a=u(e.statuses,t);return r!==e.context||n!==e.data||a!==e.statuses?{context:r,data:n,statuses:a}:e}})),define("modules/clean/react/comments2/data/action_helper",["require","exports","tslib","modules/clean/react/comments2/data/selectors","modules/clean/react/comments2/util"],(function(e,t,r,n,a){"use strict";function i(e){return{error:e+".Error",request:e+".Request",success:e+".Success"}}function o(e){return{actionTypes:i(e),name:e,type:"async"}}function s(e){return{actionType:e,name:e,type:"sync",zero:!1}}function c(e){return{actionType:e,name:e,type:"sync",zero:!0}}function l(){var e=this;return function(t,i){return r.__awaiter(e,void 0,void 0,(function(){var e,o,s,c,l,u,d;return r.__generator(this,(function(r){switch(r.label){case 0:return e=i.action,o=i.args,s=i.dispatch,c=i.context,l=i.getState,a.isContextSame(c,n.getContext(l()))?[3,2]:[4,t(i)];case 1:return[2,r.sent()];case 2:s({type:e.actionTypes.request,payload:o,meta:{args:o}}),r.label=3;case 3:return r.trys.push([3,5,,6]),[4,t(i)];case 4:return u=r.sent(),s({type:e.actionTypes.success,payload:u,meta:{args:o}}),[2,u];case 5:throw d=r.sent(),s({type:e.actionTypes.error,error:d,meta:{args:o}}),d;case 6:return[2]}}))}))}}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.syncReduxAction=function(e,t){return e.zero?{type:e.actionType}:{type:e.actionType,payload:t}},t.requestReduxAction=function(e,t){return{type:e.actionTypes.request,payload:t,meta:{args:t}}},t.successReduxAction=function(e,t,r){return{type:e.actionTypes.success,payload:r,meta:{args:t}}},t.errorReduxAction=function(e,t,r){return{type:e.actionTypes.error,error:r,meta:{args:t}}},t.asyncActionConstants=i,t.asyncAction=o,t.syncAction=s,t.syncAction0=c,t.namespacedActions=function(e){return{asyncAction:function(t){return o(e+"/"+t)},syncAction:function(t){return s(e+"/"+t)},syncAction0:function(t){return c(e+"/"+t)}}},t.syncHandler=function(e){return e.zero?function(){return{type:e.name}}:function(t){return{payload:t,type:e.name}}},t.createAsyncHandler=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,a){return function(i){return function(o,s){return r.__awaiter(void 0,void 0,void 0,(function(){var c,l;return r.__generator(this,(function(u){switch(u.label){case 0:c=n.getContext(s()),l=e.reduceRight((function(e,t){return function(n){return r.__awaiter(void 0,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,t(e,n)];case 1:return[2,r.sent()]}}))}))}}),(function(e){return a(i,e)})),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,l({action:t,args:i,dispatch:o,getState:s,context:c})];case 2:return[2,u.sent()];case 3:return u.sent(),[3,4];case 4:return[2]}}))}))}}}},t.dispatchMiddleware=l,t.thunkHandler=t.createAsyncHandler(),t.asyncHandler=t.createAsyncHandler(l())})),define("modules/clean/react/file_activity_stream/tti_logger",["require","exports","modules/clean/react/file_sidebar/file_sidebar_logger"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(){this.hasLogged=!1}return e.prototype.recordStart=function(e){this.startTs=(new Date).getTime(),this.fileId=e,this.hasLogged=!1},e.prototype.recordInteractive=function(e){if(!this.hasLogged&&e===this.fileId&&this.startTs){var t=(new Date).getTime();r.logActivityStreamInteractivity({time_start:this.startTs,time_interactive:t}),this.hasLogged=!0}},e})();t.faStreamTTILogger=new n})),define("modules/clean/react/file_sidebar/store/sidebar/reactors",["require","exports","tslib","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/store/file_activity/selectors"],(function(e,t,r,n,a,i){"use strict";function o(e){var t=a.getSidebarState(e),r=t.open,n=t.ready;return r&&n}function s(e){return!o(e)}function c(e){var t=a.getSidebarContext(e).user;n.logSidebarOpened({reason:a.getOpenReason(e),num_comments:a.getTabState(e,"comments").extra.commentCount,num_events:i.getVisibleActivityCount(e),viewing_user_id:t?t.id:null})}Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importStar(a),i=r.__importStar(i),t.reactors=function(e){e({changesFrom:s,changesTo:o},(function(e){c(e.nextState)})),e({changes:function(e,t){if(o(e)&&o(t)){var r=t.sidebar.tabs,n=e.sidebar.tabs;return!(n.activity.ready&&n.comments.ready)&&r.activity.ready&&r.comments.ready}return!1}},(function(e){c(e.nextState)}))}})),define("modules/clean/react/workflows/markup/markup_layer",["require","exports","tslib","react","react-redux","external/lodash","modules/clean/react/workflows/markup/fabric_wrapper","modules/clean/react/css","modules/clean/react/workflows/markup/selectors","modules/clean/react/file_viewer/data/actions","modules/clean/react/workflows/markup/types","modules/clean/react/workflows/markup/fabric"],(function(e,t,r,n,a,i,o,s,c,l,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSelectionChange=function(e){if(e.selected){var r=e.selected,n=r.some((function(e){return["circle","rect"].includes(e.type||"")}))?[u.FormatSubmenuEntry.FILL,u.FormatSubmenuEntry.STROKE]:[u.FormatSubmenuEntry.STROKE];t.props.setMarkupFormatSubmenu(n);var a=r.filter((function(e){return d.getStroke(e)})),i=d.getStroke(a[0]),o=a.every((function(e){return d.getStroke(e)===i})),s=r.filter((function(e){return d.getFill(e)})),c=d.getFill(s[0]),l=s.every((function(e){return d.getFill(e)===c}));i&&o&&t.props.setMarkupStroke(i),c&&l&&t.props.setMarkupFill(c)}},t.handleObjectMoving=function(e){var t=e.target;if(t&&t.canvas&&null!=t.top&&null!=t.left){t.setCoords();var r=t.canvas.getWidth(),n=t.canvas.getHeight(),a=t.getBoundingRect().width,i=t.getBoundingRect().height,o=t.getBoundingRect().top,s=t.getBoundingRect().left;if(!(i>n||a>r)){var c=.9*a,l=.9*i,u=Math.max(t.top,t.top-o-l),d=Math.max(t.left,t.left-s-c);t.top=Math.min(u,n+l-i+t.top-o),t.left=Math.min(d,r+c-a+t.left-s),t.setCoords()}}},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.createFabricCanvas(),t=this.props.markupState[this.props.page];t&&t.fabric&&e.loadFromJSON(t.fabric.toJSON(),(function(){e.requestRenderAll()})),this.props.setMarkupCanvas(this.props.page,e,this.getCanvasSize().scale)},t.prototype.createFabricCanvas=function(){var e=new o.fabric.Canvas(this.canvasId);return e.on("selection:updated",this.handleSelectionChange),e.on("selection:created",this.handleSelectionChange),e.on("object:moving",this.handleObjectMoving),e.isDrawingMode=this.props.markupState.isDrawingMode,e},t.prototype.componentDidUpdate=function(){var e=this.props,t=e.markupState,r=e.page,n=this.getCanvasSize(),a=n.width,i=n.height,o=n.scale,s=t[r]&&t[r].fabric;if(s)s.setDimensions({width:a,height:i}),this.props.updateMarkupCanvasScale(r,o);else{var c=this.createFabricCanvas();this.props.setMarkupCanvas(r,c,o)}},t.prototype.shouldComponentUpdate=function(e){return this.props.page!==e.page||!i.isEqual(this.props.pageDimensions,e.pageDimensions)||!i.isEqual(this.props.layerSize,e.layerSize)},t.prototype.getCanvasSize=function(){var e=this.props.layerSize.width,t=this.props.pageDimensions||this.props.layerSize,r=t.width,n=t.height,a=e/r;return{width:Math.round(r*a),height:Math.round(n*a),scale:a}},t.prototype.render=function(){var e=this.getCanvasSize(),t=e.width,r=e.height,a={width:t+"px",height:r+"px"};return this.canvasId="markup-canvas"+this.props.page,n.default.createElement("div",{className:"fv-markup-layer",style:a},n.default.createElement("canvas",{id:this.canvasId,width:t,height:r}))},t})((n=r.__importDefault(n)).default.Component);t._MarkupLayer=p;t.ConnectedMarkupLayer=a.connect((function(e){return{markupState:c.getMarkupState(e)}}),{setMarkupCanvas:l.setMarkupCanvas,updateMarkupCanvasScale:l.updateMarkupCanvasScale,setMarkupFormatSubmenu:l.setMarkupFormatSubmenu,setMarkupFill:l.setMarkupFill,setMarkupStroke:l.setMarkupStroke})(p);var m=s.requireCssWithComponent(t.ConnectedMarkupLayer,["/static/css/file_viewer/markup_layer-vfl8rimjm.css"]);t.MarkupLayer=m})),define("modules/clean/previews/pending_upload_watcher",["require","exports","tslib","modules/clean/ajax","modules/clean/react/file_viewer/data/actions","modules/core/browser","modules/core/uri"],(function(e,t,r,n,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),i=r.__importStar(i);var s=(function(){function e(e,t,r){void 0===r&&(r=""),this.pollUrl=new o.URI({path:"/sp/"}).updateQuery({link_type:e,link_key:t,secure_hash:r}).toString()}return e.prototype.startPolling=function(){this.pollPending()},e.prototype.pollSuccess=function(e){var t=JSON.parse(e);t.hasOwnProperty("upload_status")&&"complete"===t.upload_status?a.pendingFileUploaded():setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollFailure=function(e){e.status<400||e.status>=500?this.retryPoll():i.reload(!0)},e.prototype.retryPoll=function(){setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollPending=function(){var e=this;n.SilentBackgroundRequest({url:this.pollUrl,success:function(t){e.pollSuccess(t)},error:function(t){e.pollFailure(t)}})},e})();t.PendingUploadWatcher=s})),define("modules/clean/react/open_in_app/button",["require","exports","tslib","react","spectrum/button","modules/clean/open_in_app/actions","modules/core/i18n","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants"],(function(e,t,r,n,a,i,o,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(t){var r=e.call(this,t)||this;return r.handleClick=function(){s.logUserAction(c.UserAction.OpenInApp,r.props.userActionContext),i.openInApp(r.props.urls,{onAppNeeded:function(){return r.setState({showInstallAppText:!0})},onAppInstalled:function(){return r.setState({showInstallAppText:!1})}})},r.state={showInstallAppText:!1},r}return r.__extends(t,e),t.prototype.componentWillUnmount=function(){i.cleanUp()},t.prototype.render=function(){return n.default.createElement(a.Button,{className:"control__button open-in-app-button",variant:"primary",onClick:this.handleClick},this.state.showInstallAppText?o._("Install app?"):o._("Open in app"))},t})((n=r.__importDefault(n)).default.Component);t.OpenInAppButton=l})),define("modules/clean/react/comments2/data/selectors",["require","exports","tslib","external/lodash","reselect","modules/clean/redux/selectors","modules/clean/redux/namespaces","modules/clean/react/comments2/data/types","modules/clean/react/comments2/data/util","modules/clean/react/comments2/util","modules/clean/react/file_viewer/data/selectors","modules/clean/previews/constants","modules/clean/previews/data/preview_type_util","modules/clean/react/file_viewer/data/selectors","comments2/transforms"],(function(e,t,r,n,a,i,o,s,c,l,u,d,p,m,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),l=r.__importStar(l),m=r.__importStar(m);t.IMAGE_SENTINEL="IMAGE_SENTINEL",t.getState=function(e){return i.getStateAtNamespace(e,o.COMMENTS2_NAMESPACE_KEY)};t.getContext=function(e){var r=t.getState(e).context;return r?{stream:r.stream,viewer:r.viewer}:void 0},t.getContextStatus=function(e){var r=t.getState(e).context;return r?r.status:void 0};var g=a.createSelector(t.getContextStatus,(function(e){return e===s.Comments2ContextStatus.FullyEnabled})),f=a.createSelector(t.getContextStatus,(function(e){return e===s.Comments2ContextStatus.ReadOnly}));function v(e){return p.getPreviewType(m.getPreviewApiDataForCurrentFile(e))}function h(e){return a.createSelector(t.getData,(function(t){return t[e]}))}t.isEnabled=a.createSelector([g,f],(function(e,t){return e||t})),t.getFQPath=function(e){var r=t.getContext(e);return r?r.stream.fq_path:void 0},t.getViewer=function(e){var r=t.getContext(e);return r?r.viewer:void 0},t.getViewerId=function(e){var r=t.getViewer(e);return r?r.id:void 0},t.canCreateAnnotations=function(e){var r=t.getContext(e);return!(!r||!r.viewer)&&!l.isComments2Mobile()&&t.getVisibleInSidebar(e)},t.getPreviewTypeForCurrentFile=v,t.getIsComments2Ready=function(e){var t=e[o.COMMENTS2_NAMESPACE_KEY];return!(!t||!t.context||t.context.status!==s.Comments2ContextStatus.FullyEnabled&&t.context.status!==s.Comments2ContextStatus.ReadOnly)},t.getData=function(e){return t.getState(e).data},t.getRevision=a.createSelector(t.getContext,(function(e){return e&&_.streamToRevision(e.stream)})),t.getSort=a.createSelector(v,(function(e){switch(e){case d.PreviewType.Audio:case d.PreviewType.Video:return s.SortType.VideoTimeCode;default:return s.SortType.Chronological}})),t.getEditorIsEmpty=h("editorIsEmpty"),t.getThreadMap=h("threads");var w=a.createSelector(t.getThreadMap,(function(e){return n.values(e)})),S=a.createSelector(t.getContext,(function(e){return e&&e.stream.isVersionHistoryMode}));function b(e){return t.isEnabled(e)&&!l.isComments2Mobile()&&(function(e){var r=t.getData(e).onboardingVariants;switch(v(e)){case d.PreviewType.Audio:case d.PreviewType.Video:return t.getIsPlayerIntegrationEnabled(e)?r.premium_av_comments_pane_surface:r.non_premium_av_comments_pane_surface;case d.PreviewType.SsrDoc:return r.document_preview_surface||r.how_to_at_mention_comments_pane_surface;case d.PreviewType.Image:return r.image_preview_surface||r.how_to_at_mention_comments_pane_surface;case void 0:return!1;default:return r.not_annotatable_file_comments_pane_surface}})(e)}t.getThreads=a.createSelector([w,t.getSort,S,t.getRevision],(function(e,t,a,i){var o=(function(e,t){switch(t){case s.SortType.Chronological:return n.sortBy(e,[function(e){return e.timestamp.getTime()}]);case s.SortType.VideoTimeCode:var a=n.groupBy(e,(function(e){return e.annotation?"video":"global"})),i=a.video,o=a.global;return r.__spreadArrays(n.sortBy(i,[function(e){return e.annotation.time},function(e){return e.timestamp.getTime()}]),n.sortBy(o,[function(e){return e.timestamp.getTime()}]))}})(e,t);return a?(function(e,t){return e.filter((function(e){var r=e.comments[0].revisionInfo;return r.isCurrent||!t||r.revision&&r.revision.nsId===t.ns_id&&r.revision.sjId<=t.sjid}))})(o,i):o})),t.getCursor=h("cursor"),t.getUnmarkedOnboardingKeysRelevantToCurrentFile=function(e){var r,n=t.getData(e).onboardingVariants;switch(v(e)){case d.PreviewType.SsrDoc:r=["document_preview_surface","how_to_at_mention_comments_pane_surface"];break;case d.PreviewType.Image:r=["image_preview_surface","how_to_at_mention_comments_pane_surface"];break;case d.PreviewType.Audio:case d.PreviewType.Video:r=t.getIsPlayerIntegrationEnabled(e)?["premium_av_comments_pane_surface","premium_av_preview_surface"]:["non_premium_av_comments_pane_surface"];break;case void 0:return[];default:r=["not_annotatable_file_comments_pane_surface"]}return r.filter((function(e){return n[e]}))},t.getShowOnboardingOnVideo=function(e){var r=t.getData(e).onboardingVariants,n=!u.getIsMediaPlaying(e),a=u.getPauseCount(e);return t.isEnabled(e)&&!l.isComments2Mobile()&&t.getIsPlayerIntegrationEnabled(e)&&n&&!b(e)&&r.premium_av_preview_surface&&a%5==1&&a<15},t.getShowShareAsCommentOnboarding=function(e){return t.getData(e).onboardingVariants.share_as_comment},t.getShowOnboardingOnCommentsPane=b,t.getOnboardingVariants=function(e){return t.getData(e).onboardingVariants},t.getHasShownAnyModalVariant=function(e){var r=t.getData(e).modalVariantsShown;return r[s.ModalVariant.EmailVerifyModal]||r[s.ModalVariant.SignUpModal]},t.getActivatedThreadId=h("activatedThreadId");var y=a.createSelector(t.getActivatedThreadId,t.getThreadMap,(function(e,t){return e&&t[e]}));t.getActivatedTimecodeThread=function(e){var t=y(e);return t&&c.isThreadWithTimecodeAnnotation(t)?t:void 0};var k=h("documentRectangleToMakeVisible");t.getDocumentRectangleToMakeVisibleIfComments2Ready=function(e){return t.getIsComments2Ready(e)?k(e):void 0},t.getListCommentsError=h("listCommentsError"),t.getHoverThreadId=h("hoverThreadId"),t.getFocusedThreadId=h("focusedThreadId"),t.getUnresolvedTimecodeThreads=function(e){return(function(e){return t.getThreads(e).filter((function(e){return!e.resolvedInfo}))})(e).filter((function(e){var t=e.annotation;return t&&("video"===t.type||"audio"===t.type)}))},t.getShowResolved=h("showResolved"),t.getStatuses=function(e){return t.getState(e).statuses},t.getIsPlayerIntegrationEnabled=h("playerIntegrationEnabled"),t.getStickers=function(e){return t.getData(e).stickers},t.getCanEnable=function(e){return t.getData(e).enabledStatus.canEnable},t.getCanSubscribe=function(e){return t.getData(e).subscriptionStatus.canSubscribe},t.getIsSubscribed=function(e){return t.getData(e).subscriptionStatus.isSubscribed},t.getStream=function(e){var r=t.getContext(e);return r&&r.stream},t.getStreamId=function(e){var r=t.getContext(e);return r&&r.stream.id};var T=h("pendingAnnotationInfo");function C(e){return T(e).numberedAnnotation}t.getPlayerCurrentTime=function(e){return T(e).playerCurrentTime},t.getCurrentPageNumber=function(e){return T(e).currentPageNumber},t.getPendingNumberedAnnotation=C,t.getHasPendingNumberedAnnotation=function(e){return t.getIsComments2Ready(e)&&!!C(e)},t.getVisibleInSidebar=h("visibleInSidebar");var E=a.createSelector([t.getVisibleInSidebar,t.isEnabled,t.getShowResolved,w],(function(e,t,r,n){return e&&t?(r?n:n.filter((function(e){return!e.resolvedInfo}))).filter((function(e){return e.comments.some((function(e){return!e.deleted}))})):[]})),A=a.createSelector(E,(function(e){return e.filter(c.isThreadWithDocumentAnnotation)})),M=a.createSelector(A,(function(e){return n.groupBy(e,(function(e){return e.annotation.regions[0].page}))}));function I(e,t){return n.get(M(e),t,[])}function P(e){var t=e.annotation;return!!t&&("document"===t.type||"image"===t.type)}function F(e){return E(e).filter((function(e){return e&&void 0!==e.annotation&&"image"===e.annotation.type}))}t.getDisplayedThreadsForLayer=function(e,t){return void 0===t?F(e):I(e,t)},t.getDisplayedThreadsWithDocumentAnnotationsOnPage=I,t.getDisplayedThreadsWithImageAnnotations=F,t.getDisplayedThreadsWithNumberedAnnotations=function(e){return E(e).filter(P)};var O=h("canSeeCommentEditor");t.getStreamSettings=a.createSelector([g,t.getViewer,O],(function(e,t,r){return{canComment:e,canModifyThreads:r&&!!t,canShowEditor:r}})),t.getDocumentMetadata=function(e){switch(v(e)){case d.PreviewType.SsrDoc:return t.getData(e).documentMetadata;case d.PreviewType.Image:return t.IMAGE_SENTINEL;default:return}},t.getIsEditorFocusRequested=h("requestEditorFocus"),t.getThirdPartySource=h("thirdPartySource")})),define("modules/clean/react/comments2/data/actions",["require","exports","tslib","external/lodash","modules/core/browser","modules/core/i18n","modules/clean/redux/types","modules/clean/react/comments2/data/api","file-viewer/core","modules/clean/react/file_sidebar/store/instance","comments2/transforms","modules/clean/react/comments2/data/types","modules/clean/react/comments2/components/snackbars","modules/clean/react/comments2/util","modules/clean/react/comments2/data/logger","modules/clean/react/comments2/data/perf_util","modules/clean/react/comments2/data/selectors","comments2/components/utils/throttle-debounce","modules/clean/bolt","modules/clean/browse_interface","modules/clean/react/comments2/data/action_helper","modules/clean/react/file_sidebar/store/sidebar/actions","modules/clean/react/file_viewer/data/actions"],(function(e,t,r,n,a,i,o,s,c,l,u,d,p,m,_,g,f,v,h,w,S,b,y){"use strict";function k(e){var t=this,n=e.clientFn,a=e.successCallback,i=e.eventToLog;return function(e,o){return r.__awaiter(t,void 0,void 0,(function(){var t,c,l;return r.__generator(this,(function(r){switch(r.label){case 0:if(!(t=f.getContext(o()))||!t.viewer)throw new Error;c=new s.Comments2Api(t.viewer.id,t.stream),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,n(c)];case 2:return l=r.sent(),_.logEvent(i,{stream:t.stream}),a(e,o,l),[3,4];case 3:return r.sent(),_.logErrorEvent("error trying to execute client event "+i,{stream:t.stream}),[3,4];case 4:return[2]}}))}))}}function T(e){return function(r,n){r(Y(e));var a=e.thread,i=n(),o=f.getStream(i);_.logEvent("activate_thread",{stream:o,thread:a}),a.read||a.readonly||r(t.Actions.markThreadRead({threadId:a.id,origin:d.MarkThreadReadOrigin.ThreadActivated}))}}function C(){return k({clientFn:function(e){return e.enableCommenting()},successCallback:E,eventToLog:"enable_comments"})}function E(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return f.getStreamId(t())!==n.id?[2]:[4,e(j(d.Comments2ContextStatus.Pending))];case 1:return r.sent(),e(G(!0,!1)),[2]}}))}))}function A(){return k({clientFn:function(e){return e.disableCommenting()},successCallback:M,eventToLog:"disable_comments"})}function M(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var a;return r.__generator(this,(function(r){return f.getStreamId(t())!==n.id?[2]:(a=f.getContext(t()),I(e,a,!0),[2])}))}))}function I(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,e(j(d.Comments2ContextStatus.Disabled))];case 1:return t.sent(),e(y.disableMode(c.FileViewerMode.Commenting)),[4,l.store.dispatch(b.setComments2DisabledState())];case 2:return t.sent(),[2]}}))}))}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),a=r.__importStar(a),m=r.__importStar(m),_=r.__importStar(_),g=r.__importStar(g),f=r.__importStar(f),b=r.__importStar(b),t.HandleErrorArg=p.ShowErrorSnackbarArg,t.enableCommenting=C,t.disableCommenting=A,t.bolt={client:null,subscribe:function(e,r,n){var a=e.app_id,i=e.revision,o=e.token,s=e.unique_id,c=new h.SignedChannelState(a,s,i,o);t.bolt.client?t.bolt.client.update_states([c]):(t.bolt.client=new h.BoltClient([c],r,n),t.bolt.client.start())},unsubscribe:function(){t.bolt.client&&(t.bolt.client.unsubscribe(),t.bolt.client=null)}};var P=m.createBackoff(),F=P.backoff,O=P.resetBackoff;function R(e){var n=this;return function(a,i){return r.__awaiter(n,void 0,void 0,(function(){var n,o,s;return r.__generator(this,(function(r){switch(r.label){case 0:return n=i(),o=f.getContext(n),m.isContextSame(o,e)?[3,2]:(t.bolt.unsubscribe(),a(q(e)),a(Ne({setContextTime:+new Date,listCompleteTime:0})),e?(s=o&&o.viewer,e.viewer&&!m.isUserSame(s,e.viewer)&&a(t.Actions.checkOnboardingStatus(void 0)),f.getStickers(n)||a(t.Actions.getStickers(void 0)),[4,a(G(!0))]):[3,2]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}}t.setFileContext=R;var x=S.namespacedActions("Comments2"),D=x.asyncAction,W=x.syncAction,V=x.syncAction0;function U(e){var t=this,n=e.handleError,a=e.handleSuccess;return function(e,o){return r.__awaiter(t,void 0,void 0,(function(){function t(){return r.__awaiter(this,void 0,void 0,(function(){var c,l,u,d;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e(o)];case 1:return c=r.sent(),[3,3];case 2:throw l=r.sent(),(u=(function(e,t){if(t instanceof s.Comments2Error&&(t.code===s.ErrorCode.FILE_NOT_FOUND||t.code===s.ErrorCode.PERMISSION_DENIED))return{message:i._("Either that file was deleted or you no longer have access to it."),isRetriable:!1};switch(e){case pe.name:case _e.name:case he.name:return{message:i._("We were unable to post the comment."),isRetriable:!0};case fe.name:return{message:i._("We were unable to delete the comment."),isRetriable:!0};case Te.name:return{message:i._("We were unable to resolve the thread."),isRetriable:!0};case Ee.name:return{message:i._("We were unable to unresolve the thread."),isRetriable:!0};case Se.name:return{message:i._("We were unable to mark the thread as read."),isRetriable:!0};case ye.name:return{message:i._("We were unable to mark the thread as unread."),isRetriable:!0};case ze.name:return{message:i._("We were unable to subscribe to the file."),isRetriable:!0};case Ke.name:return{message:i._("We were unable to unsubscribe from the file."),isRetriable:!0};case J.name:case oe.name:case Ue.name:default:return null}})(o.action.name,l))&&n({message:u.message,retryFn:u.isRetriable?t:void 0}),l;case 3:return(d=(function(e){switch(e){case ze.name:return{message:i._("You have subscribed to the file.")};case Ke.name:return{message:i._("You have unsubscribed from the file.")};default:return null}})(o.action.name))&&a(d),[2,c]}}))}))}return r.__generator(this,(function(e){switch(e.label){case 0:return[4,t()];case 1:return[2,e.sent()]}}))}))}}function N(){return+new Date}function L(e){var t=this;return function(n,a){return r.__awaiter(t,void 0,void 0,(function(){function t(t){var r=e(a.action.name,t);if(r){var n=N();a.dispatch(ft(r,a.context,n-i))}}var i,o,c;return r.__generator(this,(function(e){switch(e.label){case 0:i=N(),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,n(a)];case 2:return o=e.sent(),[3,4];case 3:throw c=e.sent(),t(c instanceof s.Comments2Error?c.code:"unknown_error"),c;case 4:return t(),[2,o]}}))}))}}t.statusHandlingMiddleware=U,t.perfLoggingMiddleware=L;var H=S.createAsyncHandler(U({handleError:p.showErrorSnackbar,handleSuccess:p.showSuccessSnackbar}),(function(e,t){var r=t.context;if(!r||!r.viewer)throw new Error("Bad state");var a=new s.Comments2Api(r.viewer.id,r.stream);return e(n.merge({},t,{api:a,context:r}))}),(function(e){var t=this;return function(a,i){return r.__awaiter(t,void 0,void 0,(function(){var t,s;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,a(i)];case 1:return t=r.sent(),e(n.merge({},i,{payload:t,status:o.ApiClientStatus.Success})),[2,t];case 2:throw s=r.sent(),e(n.merge({},i,{error:s,status:o.ApiClientStatus.Error})),s;case 3:return[2]}}))}))}})((function(e){var t=e.context.stream,r=f.getThreadMap(e.getState());if(e.status===o.ApiClientStatus.Error)_.logErrorEvent("encountered an error with async api call "+e.action.name,{stream:t});else if(e.status===o.ApiClientStatus.Success){var n=e.args,a=e.payload;switch(e.action.name){case pe.name:var i=r[a.id];_.logEvent("new_comment",{commentId:a.id,stream:t,thread:i});break;case _e.name:i=r[n.threadId];_.logEvent("reply_to_comment",{commentId:a.id,stream:t,thread:i});break;case fe.name:i=r[n.threadId];_.logEvent("delete_comment",{commentId:n.commentId,stream:t,thread:i});break;case he.name:i=r[n.threadId];_.logEvent("edit_comment",{commentId:n.commentId,stream:t,thread:i});break;case Te.name:i=r[n.threadId];_.logEvent("resolve_thread",{stream:t,thread:i});break;case Ee.name:i=r[n];_.logEvent("unresolve_thread",{stream:t,thread:i});break;case Se.name:var s=n.origin===d.MarkThreadReadOrigin.ThreadActivated?"read_thread":"mark_thread_as_read";i=r[n.threadId];_.logEvent(s,{stream:t,thread:i});break;case ye.name:i=r[n];_.logEvent("mark_thread_as_unread",{stream:t,thread:i});break;case ze.name:_.logEvent("subscribe",{stream:t});break;case Ke.name:_.logEvent("unsubscribe",{stream:t})}}})),L((function(e,t){switch(e){case pe.name:case _e.name:case Se.name:case ye.name:case Te.name:case Ee.name:return g.threadActionCompleted(e,t);case fe.name:case he.name:return g.commentActionCompleted(e,t)}})),S.dispatchMiddleware()),z=W("SetContext"),q=S.syncHandler(z),B=W("SetContextStatus"),j=S.syncHandler(B),K=D("ListComments"),G=function(e,n){return void 0===e&&(e=!1),void 0===n&&(n=!0),function(o,g){return r.__awaiter(void 0,void 0,void 0,(function(){var h,w,S,k,T,C,E,A,M,P,R,x,D,W,V,U,N,L,H,z,q,B,X,Y,Z,Q,J,$;return r.__generator(this,(function(r){switch(r.label){case 0:if(h=g(),!(w=f.getContext(h)))return[2];o({type:K.actionTypes.request}),S=w.stream,k=w.viewer,T=k?new s.Comments2Api(k.id,S):new s.Comments2LoggedOutApi(S),r.label=1;case 1:return r.trys.push([1,6,,7]),[4,T.listComments(e,f.getCursor(h))];case 2:if(C=r.sent(),E=C.bolt_info,A=C.cursor,M=C.status,P=C.supported_enhancements,R=C.threads,x=C.users,D=C.permissions,W=+new Date,V=f.getContextStatus(h),U=M[".tag"],N="enabled"===U||"readonly"===U,V===d.Comments2ContextStatus.Pending&&N&&(L=f.getData(h),H=L.perfEvents&&L.perfEvents.setContextTime||0,o(t.Actions.logSimplePerfEvent("initial_list_completed_ms",W-H))),z=g(),q=f.getContext(z),!m.isContextSame(q,w))return[2];if(D&&(o(Ve({canEnable:D.can_enable_commenting})),o(He({canSubscribe:D.can_subscribe,isSubscribed:D.is_subscribed})),o(De(D.can_see_comment_editor)),o(N?y.enableMode(c.FileViewerMode.Commenting):y.disableMode(c.FileViewerMode.Commenting))),P&&(B=P.third_party_source,X=P.time_based_annotations,Y=P.time_based_annotations_upsell_tooltip_variant,Z=(void 0===Y?{".tag":"other"}:Y)[".tag"],X&&o(Ie()),"other"!==Z&&o(Fe(Z)),B&&o(Re(B[".tag"]))),Q=n?(te=/comment_id=(.*)/.exec(a.get_uri().getFragment()))?te[1]:void 0:void 0,V===d.Comments2ContextStatus.Pending)switch(M[".tag"]){case"disabled":null!=D&&D.can_enable_commenting,I(o),Q&&p.showErrorSnackbar({message:i._("Comments are disabled on this file.")});break;case"enabled":o(Ne({listCompleteTime:W})),o(j(d.Comments2ContextStatus.FullyEnabled)),l.store.dispatch(b.setComments2ShownState({commentCount:R.filter((function(e){return!e.resolved})).length}));break;case"readonly":o(Ne({listCompleteTime:W})),o(j(d.Comments2ContextStatus.ReadOnly)),l.store.dispatch(b.setComments2ShownState({commentCount:R.filter((function(e){return!e.resolved})).length}));break;case"comments1":o(j(d.Comments2ContextStatus.Comments1))}return f.isEnabled(h)||V===d.Comments2ContextStatus.Pending&&("enabled"===M[".tag"]||"readonly"===M[".tag"])?[4,o((ee=E,function(e){if(m.useBolt()){var r=v.debounce((function(){O(),e(G(!1,!1))}),2e3);t.bolt.subscribe(ee,r,(function(){t.bolt.unsubscribe(),F((function(){e(G(!1,!1))}))}))}}))]:[3,5];case 3:return r.sent(),J=u.streamToRevision(S),[4,o({type:K.actionTypes.success,payload:{authors:x,cursor:A,threads:R,currentRevision:J}})];case 4:r.sent(),Q&&o(t.Actions.activateComment(Q)),r.label=5;case 5:return[3,7];case 6:return($=r.sent())instanceof s.Comments2Error&&($.code===s.ErrorCode.FILE_NOT_FOUND?o(j(d.Comments2ContextStatus.Disabled)):k&&T instanceof s.Comments2Api&&_.logErrorEvent(($.message,": "+$.message),{stream:S})),o({type:K.actionTypes.error,error:$}),[3,7];case 7:return[2]}var ee,te}))}))}},X=W("ActivateThread"),Y=S.syncHandler(X),Z=V("DeactivateAllThreads"),Q=S.syncHandler(Z),J=D("CheckOnboardingStatus"),$=H(J,(function(e,t){return t.api.checkOnboardingStatus()})),ee=D("GetStickers"),te=H(ee,(function(e,t){return t.api.getStickers()})),re=W("HoverAnnotation"),ne=S.syncHandler(re),ae=W("FocusAnnotation"),ie=S.syncHandler(ae),oe=D("MarkOnboarded"),se=H(oe,(function(e,t){return t.api.markHasOnboarded(e)})),ce=W("DismissOnboarding"),le=S.syncHandler(ce),ue=W("MarkModalVariantShown"),de=S.syncHandler(ue),pe=D("CreateThread"),me=H(pe,(function(e,t){var r=e.annotation,n=(e.author,e.content),a=(e.guid,e.source),i=t.api,o=t.context.stream,s=u.iCommentContentToUserSubmittedComment({annotation:r,content:n,stream:o});return i.createThread(s,a)})),_e=D("ReplyToThread"),ge=H(_e,(function(e,t){e.author;var r=e.content,n=(e.guid,e.threadId),a=t.api,i=t.context.stream,o=u.iCommentContentToUserSubmittedComment({content:r,stream:i});return a.replyToThread(o,n)})),fe=D("DeleteComment"),ve=H(fe,(function(e,t){var r=e.commentId;e.threadId;return t.api.deleteComment(r)})),he=D("EditComment"),we=H(he,(function(e,t){var r=e.commentId,n=e.content,a=(e.threadId,t.api),i=t.context.stream,o=u.iCommentContentToUserSubmittedComment({content:n,stream:i});return a.editComment(r,o)})),Se=D("MarkThreadRead"),be=H(Se,(function(e,t){e.origin;var r=e.threadId;return t.api.markThreadRead(r)})),ye=D("MarkThreadUnread"),ke=H(ye,(function(e,t){return t.api.markThreadUnread(e)})),Te=D("MarkThreadResolved"),Ce=H(Te,(function(e,t){var r=e.threadId;return t.api.markThreadResolved(r)})),Ee=D("MarkThreadUnresolved"),Ae=H(Ee,(function(e,t){return t.api.markThreadUnresolved(e)})),Me=V("EnablePlayerIntegration"),Ie=S.syncHandler(Me),Pe=W("SetUpsellTooltipVariant"),Fe=S.syncHandler(Pe),Oe=W("SetThirdPartySource"),Re=S.syncHandler(Oe),xe=W("SetCanSeeCommentEditor"),De=S.syncHandler(xe),We=W("RecordEnabledStatus"),Ve=S.syncHandler(We),Ue=W("SetPerfData"),Ne=S.syncHandler(Ue),Le=W("SetSubscriptionStatus"),He=S.syncHandler(Le),ze=D("Subscribe"),qe=H(ze,(function(e,t){return t.api.subscribe()})),Be=V("ToggleShowResolved"),je=S.syncHandler(Be),Ke=D("Unsubscribe"),Ge=H(Ke,(function(e,t){return t.api.unsubscribe()})),Xe=W("UpdateDocumentCurrentPage"),Ye=S.syncHandler(Xe),Ze=W("UpdateEditorIsEmpty"),Qe=S.syncHandler(Ze),Je=W("UpdatePlayerCurrentTime"),$e=S.syncHandler(Je),et=W("DocMetadataLoad"),tt=S.syncHandler(et),rt=W("SetPendingNumberedAnnotation"),nt=S.syncHandler(rt),at=V("ClearPendingNumberedAnnotation"),it=S.syncHandler(at),ot=V("SetPendingNumberedAnnotationMayBeOffscreen"),st=S.syncHandler(ot),ct=V("RequestEditorFocus"),lt=S.syncHandler(ct),ut=V("FulfillEditorFocusRequest"),dt=S.syncHandler(ut),pt=W("TrackSidebarCommentsVisibility"),mt=S.syncHandler(pt),_t=W("ResetStore"),gt=S.syncHandler(_t);function ft(e,t,n){var a=this;return function(){return r.__awaiter(a,void 0,void 0,(function(){var a,i;return r.__generator(this,(function(r){return t?(a=t.viewer,i=t.stream,(a?new s.Comments2Api(a.id,i):new s.Comments2LoggedOutApi(i)).logPerfEvent(e,n),[2]):[2]}))}))}}t.ActionTypes={SetContext:z,SetContextStatus:B,ActivateThread:X,CheckOnboardingStatus:J,CreateThread:pe,DeactivateAllThreads:Z,DeleteComment:fe,EditComment:he,EnablePlayerIntegration:Me,ListComments:K,HoverThread:re,FocusThread:ae,MarkOnboarded:oe,DismissOnboarding:ce,GetStickers:ee,MarkModalVariantShown:ue,MarkThreadRead:Se,MarkThreadResolved:Te,MarkThreadUnread:ye,MarkThreadUnresolved:Ee,RecordEnabledStatus:We,ReplyToThread:_e,SetCanSeeCommentEditor:xe,SetPerfData:Ue,SetSubscriptionStatus:Le,SetThirdPartySource:Oe,SetUpsellTooltipVariant:Pe,Subscribe:ze,ToggleShowResolved:Be,Unsubscribe:Ke,UpdateDocumentCurrentPage:Xe,UpdateEditorIsEmpty:Ze,UpdatePlayerCurrentTime:Je,DocMetadataLoad:et,SetPendingNumberedAnnotation:rt,ClearPendingNumberedAnnotation:at,SetPendingNumberedAnnotationMayBeOffscreen:ot,RequestEditorFocus:ct,FulfillEditorFocusRequest:ut,TrackSidebarCommentsVisibility:pt,ResetStore:_t},t.Actions={setContextStatus:j,setFileContext:R,activateComment:function(e){return function(t,r){var n=f.getThreads(r()),a=m.findCommentThread(n,e);!a||a.comment.deleted?p.showErrorSnackbar({message:i._("That comment has been deleted.")}):a.thread.resolved&&p.showErrorSnackbar({message:i._("That comment has been resolved.")}),a&&t(T({thread:a.thread,pendingAnnotationInfo:m.getAnnotationInfoForThread(a.thread)}))}},activateThread:Y,activateThreadAndMarkAsRead:T,activateThreadByLayerClick:function(e,t){return function(r,n){var a=n();if(f.getIsComments2Ready(a)){var i=f.getDisplayedThreadsForLayer(a,e.page);r(Q());var o=m.getThreadForNumberedAnnotationAtPoint(e,i,t);o&&r(T({thread:o,wasPreviewLayerClick:!0}))}}},activateThreadByMarkerClick:function(e){return function(t){return r.__awaiter(void 0,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return(n=l.store.getState().sidebar).open?[3,2]:[4,l.store.dispatch(b.open("annotation_select"))];case 1:r.sent(),r.label=2;case 2:return"comments"===n.activeTab?[3,4]:[4,l.store.dispatch(b.selectTab("comments"))];case 3:r.sent(),r.label=4;case 4:return t(T(e)),[2]}}))}))}},checkOnboardingStatus:$,createThread:me,deactivateAllThreads:Q,deleteComment:ve,disableCommenting:A,editComment:we,enableCommenting:C,enablePlayerIntegration:Ie,hoverThread:ne,focusThread:ie,hoverThreadByLayer:function(e,t){return function(r,n){var a=n();if(f.getIsComments2Ready(a)){var i=f.getDisplayedThreadsForLayer(a,e.page),o=m.getThreadForNumberedAnnotationAtPoint(e,i,t);f.getHoverThreadId(a)!==(o&&o.id)&&r(ne(o&&o.id))}}},getStickers:te,listComments:G,markOnboarded:se,markOnboardedIfUnmarked:function(e){return function(t,r){f.getOnboardingVariants(r())[e]&&t(se(e))}},dismissOnboarding:le,markModalVariantShown:de,markThreadRead:be,markThreadResolved:Ce,markThreadUnread:ke,markThreadUnresolved:Ae,recordEnabledStatus:Ve,replyToThread:ge,setCanSeeCommentEditor:De,setPerfData:Ne,setSubscriptionStatus:He,setThirdPartySource:Re,setUpsellTooltipVariant:Fe,subscribe:qe,toggleShowResolved:je,unsubscribe:Ge,updateDocumentCurrentPage:Ye,updateEditorIsEmpty:Qe,updatePlayerCurrentTime:$e,setPendingNumberedAnnotation:nt,clearPendingNumberedAnnotation:it,setPendingNumberedAnnotationMayBeOffscreen:st,requestEditorFocus:lt,fulfillEditorFocusRequest:dt,trackSidebarCommentsVisibility:mt,openVersionHistory:function(){return function(e,t){var r=t(),n=f.getViewerId(r),i=f.getFQPath(r);if(i&&n){var o=w.getFileHistoryUrl({fqPath:i,userId:n});a.redirect(o)}}},docMetadataLoad:tt,logPerfEvent:function(e,t){var n=this;return function(a,i){return r.__awaiter(n,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){return n=f.getContext(i()),a(ft(e,n,t)),[2]}))}))}},logSimplePerfEvent:function(e,t){var n=this;return function(a,i){return r.__awaiter(n,void 0,void 0,(function(){var n,a;return r.__generator(this,(function(r){return n=i(),(a=f.getContext(n))&&a.viewer&&new s.Comments2Api(a.viewer.id,a.stream).logSimplePerfEvent(e,t),[2]}))}))}},resetStore:gt}})),define("modules/clean/react/watermarking/watermarking_layer",["require","exports","tslib","react","react-redux","modules/clean/react/css","modules/clean/react/file_viewer/data/actions","modules/clean/react/watermarking/drawing","modules/clean/react/watermarking/selectors","modules/clean/react/watermarking/utils","modules/clean/react/watermarking/types"],(function(e,t,r,n,a,i,o,s,c,l,u){"use strict";function d(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var r=t.getContext("2d");if(!r)return 0;r.drawImage(e,0,0);for(var n,a,i,o=r.getImageData(0,0,t.width,t.height).data,s=0,c=0,l=o.length;c<l;c+=4)n=o[c],a=o[c+1],i=o[c+2],s+=Math.floor((n+a+i)/3);return Math.floor(s/(e.width*e.height))}Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.updateWatermarkColor=function(){var e=t.props,r=e.thumbUrl,n=e.watermark;r?(t.img=new Image,t.img.crossOrigin="use-credentials",t.img.onload=function(){var e=d(t.img)<127?"white":"black";t.setTextWatermark({color:e})},t.img.src=r):t.setTextWatermark({color:n.textWatermarkingOptions.color})},t.updateWatermarkFontSize=function(){var e=t.props,r=e.pageDimensions,n=e.watermark;if(r){var a=n.textWatermarkingOptions.size,i=Math.floor((r.width+r.height)/2),o=Math.floor(i/200),s=Math.floor(i/5),c=a!==l.DEFAULT_WATERMARKING_STATE.textWatermarkingOptions.size&&o<a&&a<s?a:Math.floor(i/40);t.setTextWatermark({size:c,minSize:o,maxSize:s})}},t.canvasRef=function(e){t.canvas=e},t.redraw=function(){var e=t.props,r=e.tilingFunc,n=e.watermark;if(r&&t.canvas&&n){var a=t.canvas.getContext("2d");if(a){var i=u.getWatermarkingOptions(n),o=t.getCanvasSize(),c=o.canvasWidth,d=o.canvasHeight,p=o.scale;if(a.clearRect(0,0,c,d),i.position!==u.WatermarkPosition.REPEAT){var m,_=i.angle/180*Math.PI;if(n.mode===u.WatermarkingMode.TEXT){if(!(g=n.textWatermarkingOptions).text)return;m=s.drawTextTile(g.text,g.size*p,g.fontFamily,g.color,g.opacity/100,_).canvas}else{var g;if(!(g=n.imageWatermarkingOptions).image)return;m=s.drawImageTile(g.image,g.size*p,g.opacity/100,_).canvas}if(m){var f=i.marginX*p,v=i.marginY*p,h=f,w=v;switch(i.position){case u.WatermarkPosition.CENTER:h=(c-m.width)/2,w=(d-m.height)/2;break;case u.WatermarkPosition.NORTHEAST:h=c-m.width-f;break;case u.WatermarkPosition.SOUTHWEST:w=d-m.height-v;break;case u.WatermarkPosition.SOUTHEAST:h=c-m.width-f,w=d-m.height-v}a.drawImage(m,h,w)}}else{var S=void 0;try{S=r(p)}catch(e){if(e.message===l.WatermarkingError.TILE_NO_INPUT)return;throw e}for(var b=0,y=0,k=(S.startY+y)%S.distanceY-S.height;k<d;k+=S.distanceY){for(var T=(S.startX+b)%S.distanceX-S.width;T<c;T+=S.distanceX)a.drawImage(S.canvas,T,k);b+=S.offsetXPerRow,y+=S.offsetYPerCol}}}}},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.updateWatermarkColor(),this.updateWatermarkFontSize(),this.redraw(),this.props.pageDimensions&&this.props.setPageDimensions(this.props.pageDimensions)},t.prototype.componentDidUpdate=function(e){this.props.thumbUrl!==e.thumbUrl&&this.updateWatermarkColor(),this.redraw()},t.prototype.setTextWatermark=function(e){var t=this.props,r=t.updateWatermarkOptions;t.watermark.mode===u.WatermarkingMode.TEXT&&r({textWatermarkingOptions:e})},t.prototype.getCanvasSize=function(){var e=this.props.layerSize.width,t=this.props.pageDimensions||this.props.layerSize,r=t.width,n=t.height,a=e/r;if(this.props.watermark){var i=u.getWatermarkingOptions(this.props.watermark);a=Math.min(a,i.scale)}return{canvasWidth:Math.round(r*a),canvasHeight:Math.round(n*a),scale:a}},t.prototype.render=function(){var e=this.props,t=e.watermark,r=e.tilingFunc;if(!t||!r)return null;var a=this.props.layerSize,i=a.width,o=a.height,s=this.getCanvasSize(),c=s.canvasWidth,l=s.canvasHeight,u={width:i+"px",height:o+"px"};return n.default.createElement("canvas",{ref:this.canvasRef,className:"fv-watermarking-layer",style:u,width:c,height:l})},t})((n=r.__importDefault(n)).default.PureComponent);t._WatermarkingLayer=p;t.ConnectedWatermarkingLayer=a.connect((function(e){return{watermark:c.getWatermarkState(e),tilingFunc:c.getWatermarkTilingFunc(e)}}),{updateWatermarkOptions:o.updateWatermarkOptions,setPageDimensions:o.setPageDimensions})(p);var m=i.requireCssWithComponent(t.ConnectedWatermarkingLayer,["/static/css/file_viewer/watermarking_layer-vflNek1am.css"]);t.WatermarkingLayer=m})),define("modules/clean/react/file_sidebar/file_sidebar_logger",["require","exports","tslib","modules/clean/ajax","modules/clean/react/file_viewer/models"],(function(e,t,r,n,a){"use strict";function i(e,t){var r=a.FileViewerSession.currentSession,i=a.FilePreviewSession.currentSession;if(i&&r){var o={event_name:e,file_viewer_session_id:r.id,file_preview_session_id:i.id,file_ns_id:i.file.ns_id,file_sjid:i.file.sjid,extra:JSON.stringify(t)};n.SilentBackgroundRequest({url:"/log/file_sidebar",data:o})}}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.logSidebarTabSelected=function(e){i("sidebar_tab_selected",e)},t.logSidebarOpened=function(e){i("sidebar_opened",e)},t.logSidebarClosed=function(e){i("sidebar_closed",e)},t.logActivityStreamInteractivity=function(e){i("activity_stream_interactivity",e)},t.logFileViewActivityCardExpanded=function(e){i("file_view_activity_expanded",e)}})),define("modules/clean/loggers/workflows_logger",["require","exports","tslib","modules/clean/logging/hive/schemas/web-workflows","modules/clean/logging/telemetry","modules/clean/previews/util","modules/clean/react/file_viewer/models","modules/clean/logging/hive/schemas/web-workflows"],(function(e,t,r,n,a,i,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importStar(a),t.hiveLogger=new a.HiveLogger,t.WorkflowsEventExtra=s.WorkflowsEventExtra,(function(e){e.WatermarkApplyOverwrite="watermark_apply_overwrite",e.WatermarkApplySaveAsCopy="watermark_apply_save_as_copy",e.WatermarkCancel="watermark_cancel",e.WatermarkEducationTooltipExposed="watermark_education_tooltip_exposed",e.WatermarkEducationTooltipClicked="watermark_education_tooltip_clicked",e.WatermarkEnable="watermark_enable",e.WatermarkOpenApplyMenu="watermark_open_apply_menu",e.WatermarkPositionMenuOpened="watermark_position_menu_opened",e.WatermarkPositionMenuSelectionMade="watermark_position_menu_selection_made",e.WatermarkRotationClicked="watermark_rotation_clicked",e.WatermarkSizeChanged="watermark_size_changed",e.WatermarkTextInputEnterFocus="watermark_text_input_enter_focus",e.WatermarkTextInputExitFocus="watermark_text_input_exit_focus",e.WatermarkTransparencyChanged="watermark_transparency_changed",e.WatermarkUpsellHeaderButtonClicked="watermark_upsell_header_button_clicked",e.WatermarkUpsellPopoverClickedProCopy="watermark_upsell_popover_clicked_pro_copy",e.WatermarkUpsellPopoverClickedWmCopy="watermark_upsell_popover_clicked_wm_copy",e.WatermarkUpsellPopoverExposedProCopy="watermark_upsell_popover_exposed_pro_copy",e.WatermarkUpsellPopoverExposedWmCopy="watermark_upsell_popover_exposed_wm_copy",e.WatermarkUpsellSingleLineProClicked="watermark_upsell_single_line_pro_clicked",e.WatermarkUpsellSingleLineProExposed="watermark_upsell_single_line_pro_exposed",e.WatermarkUpsellTooltipClicked="watermark_upsell_tooltip_clicked",e.WatermarkUpsellTooltipExposed="watermark_upsell_tooltip_exposed",e.WatermarkVersionHistoryClicked="watermark_version_history_clicked",e.WatermarkTextTabClicked="watermark_type_text_clicked",e.WatermarkImageTabClicked="watermark_type_image_clicked",e.WatermarkImageUploadClicked="watermark_image_upload_clicked",e.WatermarkImageUploaded="watermark_image_uploaded",e.WatermarkImageDeleted="watermark_image_deleted",e.WatermarkColorClicked="watermark_color_clicked",e.WatermarkToolbarClicked="watermark_toolbar_clicked",e.WatermarkPageNumberClicked="watermark_page_number_clicked",e.WatermarkArrowClicked="watermark_arrow_clicked",e.WatermarkPagePreviewClicked="watermark_page_preview_clicked",e.MarkupEnabled="markup_enabled",e.MarkupRectangleClicked="markup_rectangle_clicked",e.MarkupCircleClicked="markup_circle_clicked",e.MarkupTextboxClicked="markup_textbox_clicked",e.MarkupArrowClicked="markup_arrow_clicked",e.MarkupDrawClicked="markup_draw_clicked",e.MarkupApplyOverwrite="markup_apply_overwrite",e.MarkupApplySaveAsCopy="markup_apply_save_as_copy",e.MarkupCancel="markup_cancel",e.MarkupDelete="markup_delete",e.MarkupCustomizationClicked="markup_customization_clicked"})(t.WorkflowsEvent||(t.WorkflowsEvent={})),t.logWorkflowsEvent=function(e,r,a){var s=o.FilePreviewSession.currentSession;if(s&&s.fileViewerSession){var c={event_name:e,source_context:s.sourceContext,device_type:s.fileViewerSession.deviceType,milestone:r,ns_id:s.file.ns_id,file_obj_id:s.file.file_id,file_viewer_session_id:s.fileViewerSession.id,file_preview_session_id:s.id,file_size:s.file.bytes||-1,file_preview_size:s.previewSize,file_extension:i.getWhitelistedExtensionFromFile(s.file),platform:"desktop"===s.fileViewerSession.deviceType?"web":"mobile_web",extra:a};t.hiveLogger.log(new n.WebWorklowsLoggingTableRow(c))}}})),define("modules/clean/react/previews/toolbar_flip_buttons",["require","exports","tslib","react","external/lodash","classnames","file-viewer/strings","modules/clean/i18n/formatters","file-viewer/toolbar","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/constants/page_load"],(function(e,t,r,n,a,i,o,s,c,l,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),a=r.__importStar(a),i=r.__importDefault(i);var p=s.createFormatters(d.USER_LOCALE,o.strings);t.ToolbarFlipButtons=function(e){var t=e.className,r=e.count,o=e.index,s=e.onClickNext,d=void 0===s?a.noop:s,m=e.onClickPrevious,_=void 0===m?a.noop:m;return null==r||null==o||r<1?null:n.default.createElement(c.ToolbarFlipButtons,{buttonClassName:"toolbar-button-entry",className:i.default("flip-buttons","image-toolbar__item",t),count:r,intl:p,index:o,onClickPrevious:l.wrapToolbarActionWithLogging(_,u.UserAction.FlipPrevious),onClickNext:l.wrapToolbarActionWithLogging(d,u.UserAction.FlipNext)})}})),define("modules/clean/open_in_app/actions",["require","exports","tslib","modules/clean/open_in_app/types","modules/clean/open_in_mobile_app"],(function(e,t,r,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),t.openInApp=function(e,t){var r,i=t.onAppNeeded,o=t.onAppInstalled;n.areUrlsIOS(e)?a.default.open_ios(e.iOSAppUrl,e.iOSAppStoreUrl,!(r=(navigator.userAgent||"").match(/OS (\d+)_(\d+)_?(\d+)?/))||parseInt(r[1],10)>=9,i,o):n.areUrlsAndroid(e)&&a.default.open_android_intent(e.androidAppUrl)},t.openImmediately=function(e){var t;if(n.areUrlsIOS(e))t=e.iOSAppUrl;else{if(!n.areUrlsAndroid(e))return;t=e.androidAppUrl}var r=document.createElement("iframe");r.setAttribute("class","open-in-app-transport"),r.setAttribute("src",t),r.setAttribute("style","display: none"),document.body.appendChild(r)},t.cleanUp=function(){a.default.cleanup()}})),define("modules/clean/open_in_mobile_app",["require","exports","tslib","jquery","modules/clean/analytics","modules/core/exception","modules/core/i18n","modules/clean/sharing/constants"],(function(e,t,r,n,a,i,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),a=r.__importStar(a);var c=(function(){function e(){}return e.initClass=function(){var e=this;this.vischange_listener=null,this.open_app_mode=!0,this.try_open_ios_9=function(t,r,n,a){return void 0===n&&(n=function(){}),void 0===a&&(a=function(){}),e.vischange_listener||(e.vischange_listener=function(t){return e.open_app_mode=!0,a()},document.addEventListener("visibilitychange",e.vischange_listener)),e.open_app_mode?(e.open_app_mode=!1,e._onOpenLoggingHandler(),n(),window.location=t):(e._onInstallLoggingHandler(),window.location=r)},this.fallback_will_launch=!1,this.try_open=function(t,r,i){if(e._onOpenLoggingHandler(),!e.fallback_will_launch){var o=n.default("body"),c=!1,l=function(e){return c=!0};document.addEventListener("visibilitychange",l);var u,d=!1,p=function(e){return d=!0};window.addEventListener("pagehide",p),null!=i&&a.ShareTibEventLogger.log_unauth("CLICK_MOBILE_OPEN",s.SHARE_ACTION_ORIGIN_TYPE.WEB_MOBILE,{scl_url:i}),u=n.default("<iframe />",{src:t,style:"display: none;"}),o.append(u);var m=Date.now();return setTimeout((function(){if(e.fallback_will_launch=!1,document.removeEventListener("visibilitychange",l),window.removeEventListener("pagehide",p),!d&&!c&&Date.now()<m+4700)return null!=i&&a.ShareTibEventLogger.log_unauth("CLICK_MOBILE_INSTALL",s.SHARE_ACTION_ORIGIN_TYPE.WEB_MOBILE,{scl_url:i}),window.location.replace(r)}),3200),e.fallback_will_launch=!0}}},e._onOpenLoggingHandler=function(){},e._onInstallLoggingHandler=function(){},e.registerLoggingHandlers=function(e,t){return this._onOpenLoggingHandler=e,this._onInstallLoggingHandler=t},e.open_on_click=function(e,t,r,a,i,s,c){var l=this;void 0===s&&(s=null);return n.default(r).on("click",(function(r){if(r.preventDefault(),c)return l.open_android_intent(c);if(i){a||(a=n.default("<div/>"));var u=a.text();return l.try_open_ios_9(e,t,(function(){return a.text(o._("Install app?"))}),(function(){return a.text(u)}))}return l.try_open(e,t,s)}))},e.open_ios=function(e,t,r,n,a){return void 0===n&&(n=function(){}),void 0===a&&(a=function(){}),r?this.try_open_ios_9(e,t,n,a):this.try_open(e,t)},e.open_android_intent=function(e){return i.assert(e&&e.startsWith("intent://www.dropbox.com/sm/launch_intent_or_fallback_page"),"intentUrl must use intent:// protocol"),this._onOpenLoggingHandler&&this._onOpenLoggingHandler(),window.location.href=e},e.redirect_on_load=function(e,t){return this.try_open(e,t)},e.cleanup=function(){if(this.vischange_listener)return document.removeEventListener("visibilitychange",this.vischange_listener)},e})();c.initClass(),t.default=c})),define("modules/clean/react/file_viewer/controller_mode",["require","exports","modules/clean/api_v2/noauth_client","modules/clean/api_v2/user_client"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchControllerMode=function(e,t){return null!=t?(function(e,t){return(new n.UserApiV2Client).ns("file_viewer").rpc("get_mode",e,{subjectUserId:t.id})})(e,t):(function(e){return(new r.NoAuthApiV2Client).ns("file_viewer").rpc("logged_out/get_mode",e,{})})(e)}})),define("modules/clean/react/file_viewer/app_download_interstitial/app_download_interstitial",["require","exports","tslib","classnames","react","spectrum/button","spectrum/file_icon","spectrum/icon_content","spectrum/icon_form","modules/clean/open_in_app/types","modules/clean/static_urls","modules/core/i18n","modules/clean/react/css"],(function(e,t,r,n,a,i,o,s,c,l,u,d,p){"use strict";function m(e){var t=e.onClose;return a.default.createElement("header",null,a.default.createElement("h1",{className:"DropboxLogo"},a.default.createElement("img",{src:u.static_url("/static/images/index/rebrand/logos/glyphs/glyph_blue-vfla3iXuq.svg"),className:"DropboxLogo--glyph",alt:"Dropbox"}),a.default.createElement("img",{src:u.static_url("/static/images/index/rebrand/logos/wordmarks/wordmark_black-vflmhE3RY.svg"),className:"Dropbox--wordmark",alt:"Dropbox"})),a.default.createElement("button",{className:"button-as-link app-download-interstitial-close","aria-label":"Close",onClick:t},a.default.createElement(c.IconForm,{name:"cancel"})))}function _(e){var t=e.appUrl,r=e.onContinue,n=e.onAppDownload;return a.default.createElement("div",{className:"app-download-interstitial-ctas"},a.default.createElement(i.Button,{className:"app-download-interstitial-cta",size:"large",href:t,onClick:n},d._("Get the app")),a.default.createElement(i.Button,{className:"app-download-interstitial-cta",size:"large",variant:"secondary",onClick:r},d._("Or continue to website")))}function g(e){var t,r,n=e.fileOrFolderName,i=e.isFolder,c=e.ownerName,l=e.ownerTeamName;return a.default.createElement("section",{className:"app-download-interstitial-content"},a.default.createElement("header",null,a.default.createElement("h2",null,d._("Get a better view with our mobile app"))),a.default.createElement("div",{className:"app-download-interstitial-content-thumbnail"},i?a.default.createElement(s.IconContent,{name:"folder_shared-large"}):a.default.createElement(o.FileIcon,{path:n,variant:"large"}),a.default.createElement("p",{className:"app-download-interstitial-filename"},n),a.default.createElement("p",{className:"app-download-interstitial-owner"},(r=l,(t=c)&&r?d.intl.formatMessage(d._("%(owner)s (%(team)s) shared this with you."),{owner:t,team:r}):t&&!r?d.intl.formatMessage(d._("%(owner)s shared this with you."),{owner:t}):!t&&r?d.intl.formatMessage(d._("%(team)s shared this with you."),{team:r}):d._("This file was shared with you.")))))}function f(e){if(e){if(l.areUrlsIOS(e))return e.iOSAppStoreUrl;if(l.areUrlsAndroid(e))return e.androidAppUrl}}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),a=r.__importDefault(a);var v=p.requireCssWithComponent((function(e){var t=e.className,r=e.open_in_app_data,i=e.fileOrFolderName,o=e.isFolder,s=e.onClose,c=e.onContinue,l=e.onAppDownload,u=e.ownerName,d=e.ownerTeamName;return a.default.createElement("section",{className:n.default("app-download-interstitial-container",t)},a.default.createElement(m,{onClose:s}),a.default.createElement(g,{isFolder:o,fileOrFolderName:i,ownerName:u,ownerTeamName:d}),a.default.createElement(_,{onContinue:c,onAppDownload:l,appUrl:f(r)}))}),["/static/css/index/obsidian/logo-vflwvo1dq.css","/static/css/file_viewer/app_download_interstitial-vfltlXZTJ.css"]);t.AppDownloadInterstitial=v})),define("modules/clean/react/file_viewer/data/actions",["require","exports","tslib","modules/clean/ajax","modules/clean/react/file_viewer/constants","modules/clean/file_store/actions","modules/clean/previews/data/actions","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/data/selectors","modules/clean/file_store/utils","modules/clean/react/file_viewer/data/types","modules/clean/previews/data/util","modules/clean/react/file_viewer/constants","modules/clean/downloads","modules/core/uri","modules/core/browser","modules/clean/react/file_viewer/controller_mode","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/watermarking/utils","file-viewer/core","modules/clean/react/workflows/markup/fabric","modules/clean/react/workflows/markup/selectors","modules/clean/react/file_viewer/prompt/campaign_api","modules/clean/react/size_class/constants","modules/clean/react/watermarking/selectors"],(function(e,t,r,n,a,i,o,s,c,l,u,d,p,m,_,g,f,v,h,w,S,b,y,k,T,C){"use strict";function E(e){return{type:u.Actions.OpenFile,payload:{fileId:e}}}function A(e){return function(t,r){var n,a=((n={})[S.FileViewerMode.Default]=N,n[S.FileViewerMode.Documentation]=H,n[S.FileViewerMode.Commenting]=z,n[S.FileViewerMode.Watermarking]=q,n[S.FileViewerMode.Zoom]=B,n[S.FileViewerMode.Slack]=j,n[S.FileViewerMode.Markup]=K,n[S.FileViewerMode.Plugins]=G,n[S.FileViewerMode.HelloSign]=X,n);a[e]&&a[e](t,r)}}function M(e){return h.filePreviewEventEmitter.emit(p.EventType.SidebarModeSelected,v.FilePreviewSession.currentSession,{selected_mode:e}),{type:u.Actions.UpdateMode,payload:{mode:e}}}function I(e){return function(t,r){var n=c.getCurrentFileId(r());n&&t((function(e,t){return{type:u.Actions.UpdateRenderStatus,payload:{fileId:e,renderStatus:t}}})(n,e))}}function P(e){return h.filePreviewEventEmitter.emit(p.EventType.SidebarPaneSelected,v.FilePreviewSession.currentSession,{selected_pane:e}),{type:u.Actions.PushSidebarPane,payload:{paneId:e}}}function F(){return{type:u.Actions.ResetSidebarPaneStack}}function O(){return{type:u.Actions.ResetSelectedSidebarControlId}}function R(e){return{type:u.Actions.SetSelectedSidebarControlId,payload:{controlId:e}}}function x(e){var t=e===S.SidebarVisibility.Open?p.EventType.SidebarOpened:p.EventType.SidebarClosed;return h.filePreviewEventEmitter.emit(t,v.FilePreviewSession.currentSession),{type:u.Actions.SetSidebarVisibility,payload:{visibility:e}}}function D(e){return function(t,r){t({type:u.Actions.UpdateWatermarkOptions,payload:{options:e}}),w.setLocalStorageWatermarkingState(c.getCurrentUser(r()),C.getWatermarkState(r()))}}function W(e){return function(t,r){t({type:u.Actions.SwitchWatermarkingMode,payload:{mode:e}}),w.setLocalStorageWatermarkingState(c.getCurrentUser(r()),C.getWatermarkState(r()))}}function V(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var a,i;return r.__generator(this,(function(o){switch(o.label){case 0:return[4,w.getUserMetadataTextWatermarkingState(e)];case 1:return a=o.sent(),[4,w.getLocalStorageWatermarkingState(e)];case 2:return(i=o.sent())?(D({textWatermarkingOptions:r.__assign(r.__assign({},i.textWatermarkingOptions),a),imageWatermarkingOptions:i.imageWatermarkingOptions})(t,n),W(i.mode)(t,n)):a?D({textWatermarkingOptions:a})(t,n):D({textWatermarkingOptions:{text:w.getDefaultText(e)}})(t,n),[2]}}))}))}function U(e){return{type:u.Actions.SetTrialMode,payload:{isTrialMode:e}}}function N(e,t){var r=t(),n=c.getMode(r);e(U(!1)),e(O()),n!==S.FileViewerMode.Default&&e(M(S.FileViewerMode.Default))}function L(e,t,r,n){return function(a,i){var o=i(),s=c.getSidebar(o).visibility,l=c.getMode(o);s===S.SidebarVisibility.Closed&&a(x(S.SidebarVisibility.Open)),l!==e&&(a(U(!!n&&n(o))),a(R(t)),a(F()),a(P(r)),a(M(e)))}}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),m=r.__importStar(m),g=r.__importStar(g),t.openFullScreen=function(){return{type:u.Actions.OpenFullScreen}},t.closeFullScreen=function(){return{type:u.Actions.CloseFullScreen}},t.openSidebar=function(e,t){return void 0===e&&(e=a.DocType.default),function(r){r({type:u.Actions.OpenSidebar,payload:{type:e}}),s.logUserAction(a.UserAction.ToggleSidebarOn,t)}},t.closeSidebar=function(e,t){return void 0===e&&(e=a.DocType.default),function(r){r({type:u.Actions.CloseSidebar,payload:{type:e}}),s.logUserAction(a.UserAction.ToggleSidebarOff,t)}},t.dismissAppDownloadInterstitial=function(){return{type:u.Actions.DismissAppDownloadInterstitial}},t.openFileById=E,t.closeFile=function(){return{type:u.Actions.CloseFile}},t.changeMode=A,t.disableMode=function(e){return{type:u.Actions.DisableMode,payload:{mode:e}}},t.enableMode=function(e){return{type:u.Actions.EnableMode,payload:{mode:e}}},t.updateMode=M,t.openFile=function(e){var t=this;return function(n,a){return r.__awaiter(t,void 0,void 0,(function(){var t,s;return r.__generator(this,(function(r){return t=l.getFileStoreId(e),s=i.putFile(e),n(s),!d.previewDataPresentForFile(a(),e)&&!d.previewDataInFlight(a(),e)&&(s.payload.file.preview?n(o.populateFilesPreviewData([s.payload.file])):n(o.fetchPreviewData([s.payload.file]))),n(E(t)),[2]}))}))}},t.setRenderStatusForCurrentFile=I,t.setRenderStatusSuccessForCurrentFile=function(){return I(p.PreviewRenderStatus.Succeeded)},t.fetchShowOverQuotaUpsell=function(e){return function(t,r){e&&void 0===c.getShowOverQuotaUpsell(r())&&n.SilentBackgroundRequest({url:"/should_show_file_preview_upsell",data:{_subject_uid:e.id},success:function(e){try{var r=JSON.parse(e);r&&t((n=r.shouldShowFilePreviewUpsell,{type:u.Actions.SetShowOverQuotaUpsell,payload:n}))}catch(e){}var n}})}},t.pushSidebarPane=P,t.popSidebarPane=function(){return{type:u.Actions.PopSidebarPane}},t.resetSidebarPaneStack=F,t.resetSelectedSidebarControlId=O,t.setSelectedSidebarControlId=R,t.setSidebarVisibility=x,t.setPageDimensions=function(e){return{type:u.Actions.SetPageDimensions,payload:{pageDimensions:e}}},t.updateWatermarkOptions=D,t.switchWatermarkingMode=W,t.setMarkupCanvas=function(e,t,r){return{type:u.Actions.SetMarkupCanvas,payload:{page:e,fabric:t,scale:r}}},t.updateMarkupCanvasScale=function(e,t){return{type:u.Actions.UpdateMarkupCanvasScale,payload:{page:e,scale:t}}},t.setMarkupDrawingMode=function(e){return function(t,r){t({type:u.Actions.SetMarkupDrawingMode,payload:{isDrawingMode:e}}),b.setDrawingMode(y.getMarkupState(r()),e)}},t.setMarkupStroke=function(e){return function(t){t({type:u.Actions.SetMarkupStroke,payload:{color:e}}),b.setBaseBrushColor(e)}},t.setMarkupFill=function(e){return{type:u.Actions.SetMarkupFill,payload:{color:e}}},t.setMarkupFormatSubmenu=function(e){return{type:u.Actions.SetMarkupSubmenuType,payload:{formatSubmenu:e}}},t.resetMarkupState=function(){return function(e,t){b.disposeCanvas(y.getMarkupState(t())),e({type:u.Actions.ResetMarkupState})}},t.switchRevisionAction=function(e){return function(t){e.preview&&t(o.overridePreviewForComments(e,e.preview)),t({type:u.Actions.SwitchRevision,payload:{file:e}})}},t.restoreRevisionAction=function(){return function(e,t){var r=c.getActiveFile(t());r&&e(o.clearCommentsPreviewOverride(r)),e({type:u.Actions.RestoreRevision})}},t.saveForwardRevision=function(e){return function(t){t(i.putFile(e,e.revision_id)),e.preview&&t(o.overridePreviewForComments(e,e.preview)),t({type:u.Actions.SaveForwardRevision,payload:{revisionKey:e.revision_id}})}},t.download=function(e){var t=_.URI.parse(e.href);t.updateQuery({dl:"1"}),m.get({url:t.toString()})},t.pendingFileUploaded=function(){g.reload(!0)},t.setMediaPlaying=function(){return function(e){e({type:u.Actions.PlayMedia})}},t.setMediaPaused=function(){return function(e){e({type:u.Actions.PauseMedia})}},t.resetFileViewerStore=function(){return function(e){e({type:u.Actions.ResetStore})}},t.forceHideToolbar=function(){return{type:u.Actions.ForceHideToolbar}},t.disableForceHideToolbar=function(){return{type:u.Actions.DisableForceHideToolbar}},t.fetchControllerModeAction=function(e,t,n){var a=this;return function(i,o){return r.__awaiter(a,void 0,void 0,(function(){var a,s,l,d;return r.__generator(this,(function(r){switch(r.label){case 0:i({type:u.Actions.FetchControllerModeRequest}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,f.fetchControllerMode(e,t)];case 2:return a=r.sent().mode,h.filePreviewEventEmitter.emit(p.EventType.FilePreviewModeDetermined,v.FilePreviewSession.currentSession,{mode:a}),n===T.SizeClass.Small||n===T.SizeClass.Medium?(i(R(S.SidebarControlId.Documentation)),i(P(S.SidebarPaneId.Documentation)),i(M(S.FileViewerMode.Documentation)),[2]):(s=(function(e){var t=S.FileViewerMode.Default;if(e)switch(e[".tag"]){case"commenting_mode":t=S.FileViewerMode.Commenting;break;case"documentation_mode":t=S.FileViewerMode.Documentation;break;case"other":t=S.FileViewerMode.Default}return t})(a),(l=c.getMode(o()))&&l!==S.FileViewerMode.Default||i(A(s)),[3,4]);case 3:return d=r.sent(),i({type:u.Actions.FetchControllerModeError,payload:d}),[3,4];case 4:return[2]}}))}))}},t.fetchBestCampaignsAction=function(e,t){var n=this;return function(a,i){return r.__awaiter(n,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,k.fetchBestCampaigns(e.id,t)];case 1:return n=r.sent().campaigns,a({type:u.Actions.SetBestCampaign,payload:{campaign:n[0]}}),[2]}}))}))}},t.updateCurrentPageIndex=function(e){return{type:u.Actions.UpdateCurrentPageIndex,payload:{currentPageIndex:e}}},t.pageDown=function(){return{type:u.Actions.PageDown}},t.pageUp=function(){return{type:u.Actions.PageUp}},t.registerUser=function(e){return function(t,r){t({type:u.Actions.RegisterUser,payload:{user:e}}),V(e,t,r)}},t.loadWatermarkingStateFromStorage=V;var H=L(S.FileViewerMode.Documentation,S.SidebarControlId.Documentation,S.SidebarPaneId.Documentation),z=L(S.FileViewerMode.Commenting,S.SidebarControlId.Comments,S.SidebarPaneId.Comments),q=L(S.FileViewerMode.Watermarking,S.SidebarControlId.Watermarking,S.SidebarPaneId.Watermarking,(function(e){return w.allowWatermarkTrial(c.getCurrentUser(e))})),B=L(S.FileViewerMode.Zoom,S.SidebarControlId.Zoom,S.SidebarPaneId.Zoom),j=L(S.FileViewerMode.Slack,S.SidebarControlId.Slack,S.SidebarPaneId.SlackHome),K=L(S.FileViewerMode.Markup,S.SidebarControlId.Markup,S.SidebarPaneId.Markup),G=function(){},X=function(){};t.overflowZoomOn=function(){return{type:u.Actions.OverflowZoomOn}},t.overflowZoomOff=function(){return{type:u.Actions.OverflowZoomOff}}})),define("modules/clean/react/file_viewer/data/reducer",["require","exports","tslib","modules/clean/react/file_viewer/data/types","modules/clean/react/watermarking/utils","modules/clean/react/file_viewer/constants","file-viewer/core","modules/clean/react/workflows/markup/utils"],(function(e,t,r,n,a,i,o,s){"use strict";var c;Object.defineProperty(t,"__esModule",{value:!0}),t.defaultState={currentFileId:void 0,currentPageIndex:0,fileRevision:void 0,latestFileId:void 0,forceHideToolbar:!1,isFullScreen:!1,isSidebarOpen:(c={},c[i.DocType.ppt]=!0,c[i.DocType.pdf]=!1,c),mode:o.FileViewerMode.Default,disabledModes:{},renderStatuses:{},showOverQuotaUpsell:void 0,sidebar:{visibility:o.SidebarVisibility.Closed,paneStack:[],selectedControlId:void 0},watermark:a.DEFAULT_WATERMARKING_STATE,markup:s.DEFAULT_MARKUP_STATE,campaign:void 0,overflowZoom:!1},t.fileViewerReducer=function(e,a){var i,c,l,u,d,p,m;switch(void 0===e&&(e=t.defaultState),a.type){case n.Actions.CloseFile:return r.__assign(r.__assign({},e),{currentFileId:void 0,fileRevision:void 0,latestFileId:void 0});case n.Actions.OpenFile:var _=a.payload;return r.__assign(r.__assign({},e),{currentFileId:_.fileId,fileRevision:void 0,latestFileId:void 0});case n.Actions.SwitchRevision:_=a.payload;return r.__assign(r.__assign({},e),{fileRevision:_.file});case n.Actions.RestoreRevision:return r.__assign(r.__assign({},e),{fileRevision:void 0,currentFileId:e.latestFileId||e.currentFileId,latestFileId:void 0});case n.Actions.SetPageDimensions:var g=a.payload.pageDimensions;return r.__assign(r.__assign({},e),{pageDimensions:g});case n.Actions.UpdateWatermarkOptions:var f=a.payload.options;return r.__assign(r.__assign({},e),{watermark:r.__assign(r.__assign({},e.watermark),{textWatermarkingOptions:r.__assign(r.__assign({},e.watermark.textWatermarkingOptions),f.textWatermarkingOptions),imageWatermarkingOptions:r.__assign(r.__assign({},e.watermark.imageWatermarkingOptions),f.imageWatermarkingOptions)})});case n.Actions.SwitchWatermarkingMode:var v=a.payload.mode;return r.__assign(r.__assign({},e),{watermark:r.__assign(r.__assign({},e.watermark),{mode:v})});case n.Actions.SetMarkupCanvas:var h=a.payload,w=h.page,S=h.fabric,b=h.scale;return r.__assign(r.__assign({},e),{markup:r.__assign(r.__assign({},e.markup),(i={},i[w]={scale:b,fabric:S},i))});case n.Actions.UpdateMarkupCanvasScale:var y=a.payload;w=y.page,b=y.scale;return r.__assign(r.__assign({},e),{markup:r.__assign(r.__assign({},e.markup),(c={},c[w]=r.__assign(r.__assign({},e.markup[w]),{scale:b}),c))});case n.Actions.ResetMarkupState:return r.__assign(r.__assign({},e),{markup:s.DEFAULT_MARKUP_STATE});case n.Actions.SetMarkupDrawingMode:var k=a.payload.isDrawingMode;return r.__assign(r.__assign({},e),{markup:r.__assign(r.__assign({},e.markup),{isDrawingMode:k})});case n.Actions.SetMarkupFill:var T=a.payload.color;return r.__assign(r.__assign({},e),{markup:r.__assign(r.__assign({},e.markup),{fillColor:T})});case n.Actions.SetMarkupStroke:T=a.payload.color;return r.__assign(r.__assign({},e),{markup:r.__assign(r.__assign({},e.markup),{strokeColor:T})});case n.Actions.SetMarkupSubmenuType:var C=a.payload.formatSubmenu;return r.__assign(r.__assign({},e),{markup:r.__assign(r.__assign({},e.markup),{formatSubmenu:C})});case n.Actions.SaveForwardRevision:_=a.payload;return r.__assign(r.__assign({},e),{latestFileId:_.revisionKey});case n.Actions.UpdateMode:_=a.payload;return r.__assign(r.__assign({},e),{mode:_.mode});case n.Actions.DisableMode:_=a.payload;return r.__assign(r.__assign({},e),{disabledModes:r.__assign(r.__assign({},e.disabledModes),(l={},l[_.mode]=!0,l))});case n.Actions.EnableMode:_=a.payload;return r.__assign(r.__assign({},e),{disabledModes:r.__assign(r.__assign({},e.disabledModes),(u={},u[_.mode]=!1,u))});case n.Actions.OpenFullScreen:return r.__assign(r.__assign({},e),{isFullScreen:!0});case n.Actions.CloseFullScreen:return r.__assign(r.__assign({},e),{isFullScreen:!1});case n.Actions.OpenSidebar:_=a.payload;return r.__assign(r.__assign({},e),{isSidebarOpen:r.__assign(r.__assign({},e.isSidebarOpen),(d={},d[_.type]=!0,d))});case n.Actions.CloseSidebar:_=a.payload;return r.__assign(r.__assign({},e),{isSidebarOpen:r.__assign(r.__assign({},e.isSidebarOpen),(p={},p[_.type]=!1,p))});case n.Actions.DismissAppDownloadInterstitial:return r.__assign(r.__assign({},e),{appDownloadInterstitialDismissed:!0});case n.Actions.SetShowOverQuotaUpsell:_=a.payload;return r.__assign(r.__assign({},e),{showOverQuotaUpsell:_});case n.Actions.UpdateRenderStatus:_=a.payload;return r.__assign(r.__assign({},e),{renderStatuses:r.__assign(r.__assign({},e.renderStatuses),(m={},m[_.fileId]=_.renderStatus,m))});case n.Actions.PlayMedia:return r.__assign(r.__assign({},e),{isMediaPlaying:!0});case n.Actions.PauseMedia:return r.__assign(r.__assign({},e),{isMediaPlaying:!1,pauseCount:e.pauseCount?e.pauseCount+1:1});case n.Actions.ResetStore:return t.defaultState;case n.Actions.UpdateCurrentPageIndex:_=a.payload;return r.__assign(r.__assign({},e),{currentPageIndex:_.currentPageIndex});case n.Actions.ForceHideToolbar:return r.__assign(r.__assign({},e),{forceHideToolbar:!0});case n.Actions.DisableForceHideToolbar:return r.__assign(r.__assign({},e),{forceHideToolbar:!1});case n.Actions.PopSidebarPane:return e.sidebar.paneStack.length<1?e:r.__assign(r.__assign({},e),{sidebar:r.__assign(r.__assign({},e.sidebar),{paneStack:e.sidebar.paneStack.slice(0,-1)})});case n.Actions.PushSidebarPane:_=a.payload;return e.sidebar.paneStack.includes(_.paneId)?e:r.__assign(r.__assign({},e),{sidebar:r.__assign(r.__assign({},e.sidebar),{paneStack:r.__spreadArrays(e.sidebar.paneStack,[_.paneId])})});case n.Actions.SetSelectedSidebarControlId:_=a.payload;return r.__assign(r.__assign({},e),{sidebar:r.__assign(r.__assign({},e.sidebar),{selectedControlId:_.controlId})});case n.Actions.ResetSidebarPaneStack:return r.__assign(r.__assign({},e),{sidebar:r.__assign(r.__assign({},e.sidebar),{paneStack:[]})});case n.Actions.ResetSelectedSidebarControlId:return r.__assign(r.__assign({},e),{sidebar:r.__assign(r.__assign({},e.sidebar),{selectedControlId:void 0})});case n.Actions.SetSidebarVisibility:_=a.payload;return r.__assign(r.__assign({},e),{sidebar:r.__assign(r.__assign({},e.sidebar),{visibility:_.visibility})});case n.Actions.FetchControllerModeError:return r.__assign(r.__assign({},e),{mode:o.FileViewerMode.Commenting});case n.Actions.SetBestCampaign:_=a.payload;return r.__assign(r.__assign({},e),{campaign:_.campaign});case n.Actions.PageDown:return void 0===(E=e.currentPageIndex)?e:r.__assign(r.__assign({},e),{currentPageIndex:E+1});case n.Actions.PageUp:var E;return void 0===(E=e.currentPageIndex)?e:r.__assign(r.__assign({},e),{currentPageIndex:E-1});case n.Actions.RegisterUser:_=a.payload;return r.__assign(r.__assign({},e),{currentUser:_.user});case n.Actions.SetTrialMode:_=a.payload;return r.__assign(r.__assign({},e),{isTrialMode:_.isTrialMode});case n.Actions.OverflowZoomOn:return r.__assign(r.__assign({},e),{overflowZoom:!0});case n.Actions.OverflowZoomOff:return r.__assign(r.__assign({},e),{overflowZoom:!1});default:return e}}})),define("modules/clean/react/file_viewer/data/selectors",["require","exports","tslib","modules/clean/redux/namespaces","modules/clean/redux/selectors","modules/clean/file_store/selectors","modules/clean/previews/data/selectors","modules/clean/react/file_viewer/constants","modules/clean/previews/data/preview_type_util","reselect","external/lodash","modules/clean/react/extensions/data/selectors","modules/clean/react/extensions/client","file-viewer/core"],(function(e,t,r,n,a,i,o,s,c,l,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),u=r.__importStar(u),t.getFileViewerState=function(e){return a.getStateAtNamespace(e,n.FILE_VIEWER_NAMESPACE_KEY)},t.getIsFullScreen=function(e){return t.getFileViewerState(e).isFullScreen},t.getIsSidebarOpen=function(e){return t.getFileViewerState(e).isSidebarOpen},t.getCurrentPageIndex=function(e){return t.getFileViewerState(e).currentPageIndex},t.getAppDownloadInterstitial=function(e){return t.getFileViewerState(e).appDownloadInterstitialDismissed},t.getCurrentFileId=function(e){return t.getFileViewerState(e).currentFileId},t.getCurrentFile=l.createSelector(u.nthArg(0),t.getCurrentFileId,i.getFile),t.getPastFile=function(e){return t.getFileViewerState(e).fileRevision},t.getCurrentUser=function(e){return t.getFileViewerState(e).currentUser},t.getMode=function(e){return t.getFileViewerState(e).mode},t.getDisabledModes=function(e){return t.getFileViewerState(e).disabledModes},t.getSidebar=function(e){return t.getFileViewerState(e).sidebar},t.getAnnotationAllowed=l.createSelector(t.getMode,(function(e){return e===m.FileViewerMode.Commenting})),t.getIsTrialMode=function(e){return t.getFileViewerState(e).isTrialMode},t.getIsEditMode=function(e){return t.getIsMarkupMode(e)||t.getIsWatermarkingMode(e)},t.getIsWatermarkingMode=function(e){return t.getMode(e)===m.FileViewerMode.Watermarking},t.getIsMarkupMode=function(e){return t.getMode(e)===m.FileViewerMode.Markup},t.getPageDimensions=function(e){return t.getFileViewerState(e).pageDimensions},t.getActiveFile=function(e){return t.getPastFile(e)||t.getCurrentFile(e)},t.getShowOverQuotaUpsell=function(e){return t.getFileViewerState(e).showOverQuotaUpsell};t.getSelectedPromptCampaign=function(e){return t.getFileViewerState(e).campaign},t.getRenderStatusForCurrentFile=function(e){var r=t.getCurrentFileId(e);if(r)return(function(e,r){return t.getFileViewerState(e).renderStatuses[r]})(e,r)},t.getIsMediaPlaying=function(e){return t.getFileViewerState(e).isMediaPlaying},t.getPauseCount=function(e){var r=t.getFileViewerState(e).pauseCount;return r||0},t.getPreviewApiDataForCurrentFile=function(e){var r=t.getCurrentFile(e);return o.getApiDataForFile(e,r).data},t.getIsFlippingEnabled=function(e){var r=t.getPreviewApiDataForCurrentFile(e);return!(t.getIsEditMode(e)||t.getIsMediaPlaying(e)||t.getIsFullScreen(e)&&c.isSsrDoc(r))},t.shouldForceHideToolbar=function(e){return t.getFileViewerState(e).forceHideToolbar},t.getExtensionsEnabled=function(e){var r=t.getActiveFile(e);return!r||!d.fileExtensionsConfigs(e)[r.file_id]||d.fileExtensionsConfigs(e)[r.file_id].displayState!==p.DisplayState.DISABLED},t.isOverflowZoomMode=function(e){return!0===t.getFileViewerState(e).overflowZoom},t.getHelloSignAppActionForFile=function(e,t){return d.getShareActionsForFile(e,t).filter((function(e){return e.app_id===s.HELLOSIGN_PROD_APP_ID}))[0]}})),define("modules/clean/react/file_viewer/data/store",["require","exports","modules/clean/redux/store","modules/clean/redux/namespaces","modules/clean/file_store/reducer","modules/clean/react/file_viewer/data/reducer","modules/clean/previews/data/reducer","modules/clean/previews/data/actions","modules/clean/file_store/actions","modules/clean/react/file_viewer/data/actions","modules/clean/react/extensions/data/store"],(function(e,t,r,n,a,i,o,s,c,l,u){"use strict";var d;Object.defineProperty(t,"__esModule",{value:!0}),t.fileViewerReducerMap=((d={})[n.FILE_NAMESPACE_KEY]=a.fileNamespaceReducer,d[n.FILE_VIEWER_NAMESPACE_KEY]=i.fileViewerReducer,d[n.PREVIEW_NAMESPACE_KEY]=o.reducer,d),t.getStoreForFileViewer=function(){return u.getStore(),r.getStoreAndRegisterReducers(t.fileViewerReducerMap)},t.hydrateFileViewerNamespace=function(e,t,r){var n=t.file;n&&e.dispatch(l.openFile(n)),r&&e.dispatch(l.registerUser(r))},t.hydrateFileStore=function(e,t){e.dispatch(s.populateFilesPreviewData(t)),e.dispatch(c.putFiles(t))},t.updateFileStore=function(e,t){e.dispatch(c.putFiles(t))}})),define("modules/clean/react/file_viewer/data/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e.CloseFile="FileViewer/CloseFile",e.CloseFullScreen="FileViewer/CloseFullScreen",e.CloseSidebar="FileViewer/CloseSidebar",e.DismissAppDownloadInterstitial="FileViewer/DismissAppDownloadInterstitial",e.DisableForceHideToolbar="FileViewer/DisableForceHideToolbar",e.ForceHideToolbar="FileViewer/ForceHideToolbar",e.UpdateMode="FileViewer/UpdateMode",e.DisableMode="FileViewer/DisableMode",e.EnableMode="FileViewer/EnableMode",e.OpenFile="FileViewer/OpenFile",e.OpenFullScreen="FileViewer/OpenFullScreen",e.OpenSidebar="FileViewer/OpenSidebar",e.PageDown="FileViewer/PageDown",e.PageUp="FileViewer/PageUp",e.PauseMedia="FileViewer/PauseMedia",e.PlayMedia="FileViewer/PlayMedia",e.PopSidebarPane="FileViewer/PopSidebarPane",e.PushSidebarPane="FileViewer/PushSidebarPane",e.SetSelectedSidebarControlId="FileViewer/SetSelectedSidebarControlId",e.ResetSidebarPaneStack="FileViewer/ResetSidebarPaneStack",e.ResetSelectedSidebarControlId="FileViewer/ResetSelectedSidebarControlId",e.ResetStore="FileViewer/ResetStore",e.UpdateCurrentPageIndex="FileViewer/UpdateCurrentPageIndex",e.RestoreRevision="FileViewer/RestoreRevision",e.SaveForwardRevision="FileViewer/SaveForwardRevision",e.SetCurrentCalloutType="FileViewer/SetCurrentCalloutType",e.SetShowOverQuotaUpsell="FileViewer/SetShowOverQuotaUpsell",e.SetSidebarVisibility="FileViewer/SetSidebarVisibility",e.SetPageDimensions="FileViewer/SetPageDimensions",e.UpdateWatermarkOptions="FileViewer/UpdateWatermarkOptions",e.SwitchWatermarkingMode="FileViewer/SwitchWatermarkingMode",e.SetMarkupCanvas="FileViewer/SetMarkupCanvas",e.UpdateMarkupCanvasScale="FileViewer/UpdateMarkupCanvasScale",e.ResetMarkupState="FileViewer/ResetMarkupState",e.SetMarkupDrawingMode="FileViewer/SetMarkupDrawingMode",e.SetMarkupFill="FileViewer/SetMarkupFill",e.SetMarkupStroke="FileViewer/SetMarkupStroke",e.SetMarkupSubmenuType="FileViewer/SetMarkupSubmenuType",e.SwitchRevision="FileViewer/SwitchRevision",e.UpdateRenderStatus="FileViewer/UpdateRenderStatus",e.RegisterUser="FileViewer/RegisterUser",e.SetTrialMode="FileViewer/SetTrialMode",e.FetchControllerModeRequest="FileViewer/FetchControllerModeRequest",e.FetchControllerModeSuccess="FileViewer/FetchControllerModeSuccess",e.FetchControllerModeError="FileViewer/FetchControllerModeError",e.FetchBestCampaign="FileViewer/FetchBestCampaign",e.SetBestCampaign="FileViewer/SetBestCampaign",e.OverflowZoomOn="FileViewer/OverflowZoomOn",e.OverflowZoomOff="FileViewer/OverflowZoomOff"})(t.Actions||(t.Actions={}))})),define("modules/clean/react/file_viewer/file_preview_event_emitter",["require","exports","tslib","eventemitter3"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),t.filePreviewEventEmitter=new n.default})),define("modules/clean/react/file_viewer/location_utils",["require","exports","tslib","modules/clean/react/file_viewer/constants","modules/clean/history","modules/core/exception"],(function(e,t,r,n,a,i){"use strict";function o(e,t){if(e&&!(t<=0))return e.split("/").slice(0,t+1).join("/")}function s(e,t){var r=a.default.get_uri();return t?r.updateQuery(e,t):r.removeQuery(e),r}function c(e){a.default.push_state(e.getPath(),e.getQuery())}Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),i=r.__importStar(i),t.getFilenameFromLocation=function(e){return e?e.query.preview:""},t.addToFileSubpath=function(e,t){return e?e+"/"+t:"/"+t},t.truncateFileSubpath=o,t.shortenFileSubpathBy=function(e,t){if(e){if(t<=0)return e;var r=e.split("/");return o(e,r.length-t-1)}},t.updateFileSubpathQuery=function(e){c(s(n.SubpathQueryKey,e))},t.getFileSubpath=function(e){var t,r=e.query[n.SubpathQueryKey];if(!(t=r instanceof Array?r.length?r[0]:void 0:r)||0===t.indexOf("/"))return t;i.reportStack("path malformed",{severity:i.SEVERITY.NONCRITICAL,exc_extra:{fileSubpath:t}})},t.getPageQuery=function(e){var t=e.query[n.PageQueryKey];if(t){var r=+t;return r||void 0}},t.updatePageQuery=function(e){e?e>0&&c(s(n.PageQueryKey,e.toString())):c(s(n.PageQueryKey,null))}})),define("modules/clean/react/file_viewer/logging",["require","exports","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/constants"],(function(e,t,r,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logUserAction=function(e,t,i){void 0===i&&(i={}),null!=r.FilePreviewSession.currentSession&&n.filePreviewEventEmitter.emit(a.EventType.FilePreviewUserAction,r.FilePreviewSession.currentSession,e,t,i)},t.wrapToolbarActionWithLogging=function(e,r){return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var o=e.apply(void 0,n);return t.logUserAction(r,a.UserActionContext.Toolbar),o}},t.wrapKeyboardActionWithLogging=function(e,r){return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var o=e.apply(void 0,n);return t.logUserAction(r,a.UserActionContext.Keyboard),o}}})),define("modules/clean/react/file_viewer/models",["require","exports","tslib","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/previews/constants","modules/clean/uuid","modules/clean/web_timing_logger","modules/core/browser","modules/core/browser_detection","modules/core/exception"],(function(e,t,r,n,a,i,o,s,c,l,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),c=r.__importStar(c),u=r.__importStar(u);var d={};d[n.EventType.FilePreviewAttemptStarted]=null,d[n.EventType.FilePreviewSupportConfirmed]=n.EventType.FilePreviewAttemptStarted,d[n.EventType.FilePreviewSupportDenied]=n.EventType.FilePreviewAttemptStarted,d[n.EventType.FilePreviewDownloadAttempted]=n.EventType.FilePreviewSupportConfirmed,d[n.EventType.FilePreviewDownloadSucceeded]=n.EventType.FilePreviewDownloadAttempted,d[n.EventType.FilePreviewDownloadFailed]=n.EventType.FilePreviewDownloadAttempted,d[n.EventType.FilePreviewRenderSucceeded]=n.EventType.FilePreviewDownloadSucceeded,d[n.EventType.FilePreviewRenderFailed]=n.EventType.FilePreviewDownloadSucceeded;var p=(function(){function e(e){this.id=e||o.UUID.v4({allowInsecure:!0}),this.deviceType=this._deviceTypeString()}return e.prototype._deviceTypeString=function(){return l.is_supported_mobile_browser()?"mobile":l.is_tablet()?"tablet":"desktop"},e.currentSession=null,e})();t.FileViewerSession=p;var m=(function(){function e(e){var t=e.id,r=e.fileViewerSession,n=e.file,a=e.previewType,i=e.sourceContext,s=e.sourceAction;this.passwordNeeded=!1,u.assert(!!r,"FileViewerSession required"),u.assert(!!n,"File required"),this.id=t||o.UUID.v4({allowInsecure:!0}),this.fileViewerSession=r,this.file=n,this.previewType=a,this.sourceContext=i,this.sourceAction=s,this.previewTimeline={},this.lastEvent=null}return e.prototype.recordEvent=function(e,t){if(void 0===t&&(t={}),!(t instanceof Object))throw new Error("extra param of recordEvent should be an object.");this.isEventInTimeline(e)||d.hasOwnProperty(e)&&this.lastEvent!==d[e]||(this.addToTimeline(e),a.filePreviewEventEmitter.emit(e,this,t),this.lastEvent=e)},e.prototype.markPrimaryEvent=function(){var e;e=window._timingData&&window._timingData.tti?window._timingData.tti.getTime():c.now(),this.primaryMarkTs||(this.primaryMarkTs=e)},e.prototype.timeToPrimaryMark=function(){return this.timeToMark(this.primaryMarkTs)},e.prototype.timeToMark=function(e){if(void 0!==e)switch(this.sourceAction){default:return;case i.PreviewSourceAction.Visit:var t=s.start_time();return void 0!==t?e-t:void 0;case i.PreviewSourceAction.Click:var r=this.previewTimeline[n.EventType.FilePreviewAttemptStarted];if(!r)return;var a=r.timestamp;if(void 0===a)return;return e-a}},e.prototype.isEventInTimeline=function(e){return e in this.previewTimeline},e.prototype.addToTimeline=function(e){this.previewTimeline[e]={timestamp:c.now()}},e.currentSession=null,e})();t.FilePreviewSession=m})),define("modules/clean/react/file_viewer/open_button/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e[e.DOWNLOAD=0]="DOWNLOAD",e[e.UNITY_FILE=1]="UNITY_FILE",e[e.UNITY_FOLDER=2]="UNITY_FOLDER",e[e.OPEN_WITH=3]="OPEN_WITH",e[e.OPEN_IN_PAPER=4]="OPEN_IN_PAPER",e[e.APP_ACTION=5]="APP_ACTION",e[e.PREPARE_FOR_SIGNATURE=6]="PREPARE_FOR_SIGNATURE",e[e.SHARE_TO_SLACK=7]="SHARE_TO_SLACK",e[e.PRESENT_IN_ZOOM=8]="PRESENT_IN_ZOOM",e[e.SHARE_TO_TRELLO=9]="SHARE_TO_TRELLO",e[e.INVITE_VIA_EMAIL=10]="INVITE_VIA_EMAIL",e[e.OPEN_WITH_CLOUD_DOC=11]="OPEN_WITH_CLOUD_DOC",e[e.OPEN_MORE_APPS=12]="OPEN_MORE_APPS",e[e.OPEN_ADD_APPS=13]="OPEN_ADD_APPS"})(t.OpenButtonAction||(t.OpenButtonAction={}))})),define("modules/clean/react/file_viewer/prompt/campaign_api",["require","exports","modules/clean/api_v2/user_client"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchBestCampaigns=function(e,t){var n={client_context:{platform:"web",locations:["targeted_bubble"],ref_page:["preview","file_viewer"],display_context:"fv_preview_type="+t}};return(new r.UserApiV2Client).ns("prompt").rpc("get_best_campaigns",n,{subjectUserId:e})}})),define("modules/clean/react/file_viewer/title_utils",["require","exports","modules/constants/python","modules/clean/filepath","modules/clean/file_store/utils","modules/core/i18n"],(function(e,t,r,n,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.closeButtonTitle=function(e){var t=(function(e){var t=e.file,o=e.fileViewAction,s=e.fileViewOrigin;return e.isVersionHistoryMode?i._("Version history"):s===r.FileViewOriginType.RECENTS?i._("Recents"):s===r.FileViewOriginType.HOME?i._("Home"):s!==r.FileViewOriginType.PHOTOS&&o!==r.FileViewActionType.SEARCH&&a.isBrowseFile(t)&&t.fq_path?n.filename(n.parent_dir(t.fq_path)):void 0})(e);return!e.sharedLinkInfo&&t?i.intl.formatMessage(i._("Back to %(folder)s"),{folder:t}):i._("Close")},t.customLogoUrl=function(e){return e?e.ownerTeamLogo:void 0}})),define("modules/clean/react/file_viewer/url_utils",["require","exports","tslib","modules/clean/history","modules/core/browser"],(function(e,t,r,n,a){"use strict";function i(e){n.default.push_state(e.getPath(),e.getQuery())}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),a=r.__importStar(a),t.linkClickHandler=function(e){return function(t){t.ctrlKey||t.metaKey||e(t)}},t.getCurrentFolderHref=function(){var e=a.get_uri();return e.removeQuery("preview"),e},t.closeFile=function(){var e,t;e="preview",(t=n.default.get_uri()).removeQuery(e),i(t)},t.openFile=function(e){(function(e,t){var r={};r[e]=t;var a=n.default.get_uri();a.updateQuery(r),i(a)})("preview",e.filename)}})),define("modules/clean/react/location/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t){void 0===t&&(t={}),this.path=e,this.query=t}return e.fromURI=function(t){return new e(t.getPath(),t.getQuery())},e})();t.Location=r})),define("modules/clean/react/location/with_location",["require","exports","tslib","react","modules/clean/react/location/types","modules/core/browser","modules/clean/history","modules/clean/react/helpers"],(function(e,t,r,n,a,i,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importStar(i),o=r.__importDefault(o);var c=function(e){return{location:e}};t.withLocation=function(e,t){var l;return void 0===t&&(t=c),(l=(function(s){function c(e){var r=s.call(this,e)||this;r.onLocationChange=function(e,n){r.setState(t(new a.Location(r.basePathComponent+"/"+decodeURIComponent(e),n),r.props))};var n=i.get_uri(),o=n.getPath();return r.basePathComponent="/"+o.split("/")[1],r.state=t(a.Location.fromURI(n),e),r}return r.__extends(c,s),c.prototype.componentDidMount=function(){o.default.add_callback(this.basePathComponent,this.onLocationChange,!0)},c.prototype.componentWillUnmount=function(){o.default.remove_callback(this.basePathComponent,this.onLocationChange)},c.prototype.render=function(){return n.default.createElement(e,r.__assign({},this.props,this.state))},c})(n.default.PureComponent)).displayName="WithLocation("+s.getDisplayName(e)+")",l}})),define("modules/clean/react/open_in_app/banner",["require","exports","tslib","react","modules/clean/react/css","modules/clean/open_in_app/actions","modules/core/i18n"],(function(e,t,r,n,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={closed:!1,showInstallAppText:!1},t.handleAppRedirect=function(){t.props.onClick&&t.props.onClick(),i.openInApp(t.props.urls,{onAppNeeded:function(){return t.setState({showInstallAppText:!0})},onAppInstalled:function(){return t.setState({showInstallAppText:!1})}})},t.dismiss=function(){t.setState({closed:!0});var e=t.props.onClose;e&&e()},t}return r.__extends(t,e),t.prototype.componentWillUnmount=function(){i.cleanUp()},t.prototype.render=function(){var e=this.state,t=e.closed,r=e.showInstallAppText;return t?null:n.default.createElement("div",{className:"open-in-app-banner-container"},n.default.createElement("button",{className:"button-as-link open-in-app-banner-text",onClick:this.handleAppRedirect},r?o._("Get the Dropbox App"):o._("View In App")),n.default.createElement("button",{className:"button-as-link open-in-app-banner-close","aria-label":"Close",onClick:this.dismiss}))},t})((n=r.__importDefault(n)).default.Component),c=a.requireCssWithComponent(s,["/static/css/open_in_app/banner-vfl1xt3Tn.css"]);t.OpenInAppBanner=c})),define("modules/clean/react/size_class/size_class",["require","exports","tslib","react","classnames","hoist-non-react-statics","spectrum/match","modules/clean/react/size_class/constants","modules/clean/react/helpers"],(function(e,t,r,n,a,i,o,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),a=r.__importDefault(a),i=r.__importDefault(i),t.SizeClass=s.SizeClass,t.withSizeClass=function(e,t){void 0===t&&(t={});var l=(function(i){function l(t){var r=i.call(this,t)||this;return r.displayName="WithSizeClass("+c.getDisplayName(e),r.onMatchSmall=function(){return r.setState({sizeClass:s.SizeClass.Small})},r.onMatchMedium=function(){return r.setState({sizeClass:s.SizeClass.Medium})},r.onMatchLarge=function(){return r.setState({sizeClass:s.SizeClass.Large})},r.onMatchExtraLarge=function(){return r.setState({sizeClass:s.SizeClass.ExtraLarge})},window.matchMedia(s.MEDIA_SIZE_CLASS_EXTRA_LARGE).matches?r.state={sizeClass:s.SizeClass.ExtraLarge}:window.matchMedia(s.MEDIA_SIZE_CLASS_LARGE).matches?r.state={sizeClass:s.SizeClass.Large}:window.matchMedia(s.MEDIA_SIZE_CLASS_MEDIUM).matches?r.state={sizeClass:s.SizeClass.Medium}:r.state={sizeClass:s.SizeClass.Small},r}return r.__extends(l,i),l.prototype.render=function(){var i,c=t.isResponsiveEnabled,l=t.responsiveClassName,u=void 0===l?"":l,d=!c||c();return n.default.createElement("div",{className:a.default((i={},i[u]=d,i))},n.default.createElement(o.Match,{media:s.MEDIA_SIZE_CLASS_SMALL,onMatch:this.onMatchSmall}),n.default.createElement(o.Match,{media:s.MEDIA_SIZE_CLASS_MEDIUM,onMatch:this.onMatchMedium}),n.default.createElement(o.Match,{media:s.MEDIA_SIZE_CLASS_LARGE,onMatch:this.onMatchLarge}),n.default.createElement(o.Match,{media:s.MEDIA_SIZE_CLASS_EXTRA_LARGE,onMatch:this.onMatchExtraLarge}),n.default.createElement(e,r.__assign({},this.props,{sizeClass:d?this.state.sizeClass:s.SizeClass.Large})))},l})(n.default.Component);return i.default(l,e)}})),define("modules/clean/react/size_class/utils",["require","exports","modules/clean/react/size_class/constants"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSmallerThanLarge=function(e){return e!==r.SizeClass.Large&&e!==r.SizeClass.ExtraLarge}})),define("modules/clean/react/watermarking/drawing",["require","exports"],(function(e,t){"use strict";function r(e,t,r,n,a){void 0===a&&(a=!1),e.save(),e.font=r+"px "+n;var i=e.measureText(t);return e.restore(),a?{width:i.width,height:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent||r}:{width:i.width,height:i.fontBoundingBoxAscent+i.fontBoundingBoxDescent||r}}Object.defineProperty(t,"__esModule",{value:!0}),t.drawTextTile=function(e,t,n,a,i,o){var s=document.createElement("canvas"),c=s.getContext("2d");if(!c)throw new Error("Cannot draw on canvas");var l=r(c,e,t,n),u=l.width,d=l.height;s.width=Math.abs(u*Math.cos(o))+Math.abs(d*Math.sin(o)),s.height=Math.abs(u*Math.sin(o))+Math.abs(d*Math.cos(o)),c.font=t+"px "+n,c.globalAlpha=i,c.fillStyle=a,c.textBaseline="bottom";var p=0,m=s.height;o<.5*Math.PI?p=d*Math.sin(o):o<Math.PI?(p=d*Math.sin(o)-u*Math.cos(o),m+=d*Math.cos(o)):o<1.5*Math.PI?(p=-u*Math.cos(o),m=0):m+=u*Math.sin(o),c.translate(p,m),c.rotate(-o),c.fillText(e,0,0);var _=r(c,e,t,n,!0),g=_.width;return{canvas:s,actualUnrotatedHeight:_.height,actualUnrotatedWidth:g}},t.drawImageTile=function(e,t,r,n){var a=document.createElement("canvas"),i=a.getContext("2d");if(!i)throw new Error("Cannot draw on canvas");var o=n||0,s=e.width*t,c=e.height*t;a.width=Math.round(Math.abs(s*Math.cos(o))+Math.abs(c*Math.sin(o))),a.height=Math.round(Math.abs(s*Math.sin(o))+Math.abs(c*Math.cos(o)));var l=0,u=0;return o<.5*Math.PI?u=s*Math.sin(o):o<Math.PI?(l=-s*Math.cos(o),u=s*Math.sin(o)-c*Math.cos(o)):o<1.5*Math.PI?(l=-s*Math.cos(o)-c*Math.sin(o),u=-c*Math.cos(o)):l=-c*Math.sin(o),i.globalAlpha=r,i.translate(l,u),i.rotate(-o),i.drawImage(e,0,0,s,c),{canvas:a,actualUnrotatedHeight:c,actualUnrotatedWidth:s}}})),define("modules/clean/react/watermarking/selectors",["require","exports","tslib","reselect","external/lodash","modules/clean/react/watermarking/types","modules/clean/react/watermarking/utils","modules/clean/react/watermarking/drawing","modules/clean/react/file_viewer/data/selectors"],(function(e,t,r,n,a,i,o,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importStar(a),t.getWatermarkState=function(e){return c.getFileViewerState(e).watermark},t.getWatermarkTilingFunc=n.createSelector(t.getWatermarkState,(function(e){return a.memoize((function(t){var r=i.getWatermarkingOptions(e),n=r.angle,a=r.opacity,c=r.size,l=n%360,u=n/180*Math.PI,d=u%(Math.PI/2),p=(function(r){if(e.mode===i.WatermarkingMode.TEXT){var n=e.textWatermarkingOptions,l=n.color,u=n.fontFamily,d=n.text;return s.drawTextTile(d,c*t,u,l,a/100,r)}var p=e.imageWatermarkingOptions.image;if(!p)throw new o.WatermarkingError(o.WatermarkingError.TILE_NO_INPUT);return s.drawImageTile(p,c*t,a/100,r)})(u),m=p.canvas,_=p.actualUnrotatedHeight,g=p.actualUnrotatedWidth,f=Math.max(_,g),v=f/2,h=f/2;e.mode===i.WatermarkingMode.TEXT&&(v=2*_,h=e.textWatermarkingOptions.lineHeight*_);var w=g+v,S=_+h,b=0,y=0,k=0;return l%180==0?(b=w,y=S,k=v/-1.2):l%180==90?(b=S,y=w):l>0&&l<90||l>180&&l<270?(b=S/Math.sin(d),y=w*Math.sin(d),k=-w*Math.cos(d)):(l>90&&l<180||l>270&&l<360)&&(b=S/Math.cos(d),y=w*Math.cos(d),k=w*Math.sin(d)),{canvas:m,width:m.width,height:m.height,distanceX:b,distanceY:y,startX:-m.width/2,startY:-m.height/2,offsetXPerRow:k,offsetYPerCol:0}}))}))})),define("modules/clean/react/watermarking/types",["require","exports"],(function(e,t){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e.TEXT="text",e.IMAGE="image"})(r=t.WatermarkingMode||(t.WatermarkingMode={})),(function(e){e.REPEAT="REPEAT",e.CENTER="CENTER",e.NORTHWEST="NORTHWEST",e.NORTHEAST="NORTHEAST",e.SOUTHEAST="SOUTHEAST",e.SOUTHWEST="SOUTHWEST"})(t.WatermarkPosition||(t.WatermarkPosition={})),t.getWatermarkingOptions=function(e){return e.mode===r.TEXT?e.textWatermarkingOptions:e.imageWatermarkingOptions}})),define("modules/clean/react/watermarking/utils",["require","exports","tslib","sjcl","external/lodash","modules/constants/file_viewer","modules/clean/i18n/formatters","modules/constants/page_load","modules/clean/file_store/utils","modules/core/i18n","modules/clean/previews/constants","modules/clean/react/watermarking/drawing","modules/clean/react/watermarking/types","modules/clean/storage","modules/core/cookies","modules/core/exception","modules/clean/react/user_metadata/api"],(function(e,t,r,n,a,i,o,s,c,l,u,d,p,m,_,g,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),a=r.__importStar(a),g=r.__importStar(g);var v=[".pdf",".jpg",".jpeg",".png",".bmp"];t.DEFAULT_SIZES={size:1,minSize:.2,maxSize:5},t.WATERMARKING_LOCAL_STORAGE_KEY="fileviewer_watermarking_data";var h=(function(e){function t(t){var r=e.call(this,t)||this;return r.message=t,r.name="WatermarkingError",r}return r.__extends(t,e),t.TILE_NO_INPUT="Unable to tile: missing text or image",t})(Error);function w(e){return e&&i.WATERMARK_TRIAL_VARIANT_BY_USER_ID?i.WATERMARK_TRIAL_VARIANT_BY_USER_ID[e.id]:""}function S(e){return!t.isWatermarkingEnabled(e)&&["DEACTIVATED_MENU","POPOVER_WM_VALUE_PROPS","POPOVER_PRO_VALUE_PROPS","TOOLTIP_ON_HOVER"].includes(w(e))}function b(e){return new Promise((function(t,r){var n=new Image;n.onload=function(){t(n)},n.onerror=function(e){r(e)},n.crossOrigin="anonymous",n.src=e}))}function y(e){var t;try{var r=n.codec.utf8String.toBits(_.Cookies.read("__Host-js_csrf"));t=n.encrypt(r,JSON.stringify(e))}catch(e){g.reportException({err:e,severity:g.SEVERITY.NONCRITICAL,tags:["watermarking"]})}return t}t.WatermarkingError=h,t.fileIsWatermarkable=function(e){return!!e&&(c.isBrowseFile(e)&&!e.read_only&&!!e.ext&&v.includes(e.ext.toLowerCase()))},t.isWatermarkingEnabled=function(e){return!!(e&&i.WATERMARKING_BY_USER_ID&&i.WATERMARKING_BY_USER_ID[e.id])},t.allowWatermark=function(e,r){return t.isWatermarkingEnabled(r)&&t.fileIsWatermarkable(e)},t.getWatermarkTrialVariant=w,t.allowWatermarkTrial=S,t.allowWatermarkOrTrial=function(e,r){return t.allowWatermark(e,r)||S(r)},t.getDefaultText=function(e){if(!e)return"DRAFT";var t=(0,o.createFormatters(s.USER_LOCALE,{}).formatDate)(new Date,{});return e.display_name+" | "+t},t.getImageDefaultSizes=function(e,r){if(!e||!r)return t.DEFAULT_SIZES;var n=e.width/r.width,a=e.height/r.height,i=Math.max(n,a);if(i*t.DEFAULT_SIZES.maxSize<=.9)return t.DEFAULT_SIZES;var o=.9/i;return{size:o/5,minSize:o/25,maxSize:o}},t.DEFAULT_WATERMARKING_STATE={mode:p.WatermarkingMode.TEXT,textWatermarkingOptions:{angle:45,color:"black",opacity:30,fontFamily:"Helvetica, sans-serif",size:20,minSize:5,maxSize:200,lineHeight:3,text:"DRAFT",position:p.WatermarkPosition.REPEAT,marginX:40,marginY:40,scale:1},imageWatermarkingOptions:r.__assign({angle:45,opacity:30,position:p.WatermarkPosition.REPEAT,marginX:40,marginY:40,scale:1},t.DEFAULT_SIZES)},t.getWatermarkScale=function(e){return e===u.PreviewType.SsrDoc?300/72:1},t.getWatermarkingLabelText=function(e,t){if(e)return t===u.PreviewType.Image?l._("Watermarking is available on PDFs, PNGs, JPEGs, and BMPs."):l._("Watermarking is available on PDFs and images.")},t.getImageFromURL=b,t.getWatermarkMilestone=function(e){return"M2"},t.setLocalStorageWatermarkingState=function(e,n){return r.__awaiter(this,void 0,void 0,(function(){var a,i;return r.__generator(this,(function(o){if(e&&n){(a=r.__assign(r.__assign({},n),{imageWatermarkingOptions:r.__assign({},n.imageWatermarkingOptions)})).imageWatermarkingOptions.image&&!a.imageWatermarkingOptions.imageAsDataURL&&(a.imageWatermarkingOptions.imageAsDataURL=d.drawImageTile(a.imageWatermarkingOptions.image,1,1).canvas.toDataURL()),delete a.imageWatermarkingOptions.image,i=y(a);try{m.UserLocalStorage.set(e.id,t.WATERMARKING_LOCAL_STORAGE_KEY,i)}catch(r){if(a.imageWatermarkingOptions.imageAsDataURL){delete a.imageWatermarkingOptions.imageAsDataURL,i=y(a);try{m.UserLocalStorage.set(e.id,t.WATERMARKING_LOCAL_STORAGE_KEY,i)}catch(e){g.reportException({err:r,severity:g.SEVERITY.NONCRITICAL,tags:["watermarking"]})}}}}return[2]}))}))},t.getLocalStorageWatermarkingState=function(e){return r.__awaiter(this,void 0,void 0,(function(){var a,i,o,s,c;return r.__generator(this,(function(r){switch(r.label){case 0:if(!(a=m.UserLocalStorage.get(e.id,t.WATERMARKING_LOCAL_STORAGE_KEY)))return[3,5];r.label=1;case 1:return r.trys.push([1,4,,5]),i=n.codec.utf8String.toBits(_.Cookies.read("__Host-js_csrf")),(o=JSON.parse(n.decrypt(i,a))).imageWatermarkingOptions.imageAsDataURL?(s=o.imageWatermarkingOptions,[4,b(o.imageWatermarkingOptions.imageAsDataURL)]):[3,3];case 2:s.image=r.sent(),r.label=3;case 3:return[2,o];case 4:return c=r.sent(),g.reportException({err:c,severity:g.SEVERITY.NONCRITICAL,tags:["watermarking"]}),[3,5];case 5:return[2]}}))}))},t.getUserMetadataTextWatermarkingState=function(e){return r.__awaiter(this,void 0,Promise,(function(){var t,n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,f.getUserMetadata(["TEXT_WATERMARKING_COLOR","TEXT_WATERMARKING_TEXT","TEXT_WATERMARKING_OPACITY","TEXT_WATERMARKING_ANGLE","TEXT_WATERMARKING_POSITION","TEXT_WATERMARKING_SIZE"],e.id)];case 1:return t=r.sent(),n={color:t.TEXT_WATERMARKING_COLOR?t.TEXT_WATERMARKING_COLOR:void 0,text:t.TEXT_WATERMARKING_TEXT,opacity:t.TEXT_WATERMARKING_OPACITY,angle:t.TEXT_WATERMARKING_ANGLE,position:t.TEXT_WATERMARKING_POSITION?t.TEXT_WATERMARKING_POSITION:void 0,size:t.TEXT_WATERMARKING_SIZE},[2,a.omitBy(n,a.isUndefined)];case 2:return i=r.sent(),g.reportException({err:i,severity:g.SEVERITY.NONCRITICAL,tags:["watermarking"]}),[2];case 3:return[2]}}))}))},t.setUserMetadataTextWatermarkingState=function(e,t){var r=t.textWatermarkingOptions;f.setUserMetadata({TEXT_WATERMARKING_COLOR:r.color,TEXT_WATERMARKING_TEXT:r.text,TEXT_WATERMARKING_OPACITY:r.opacity,TEXT_WATERMARKING_ANGLE:r.angle,TEXT_WATERMARKING_POSITION:r.position,TEXT_WATERMARKING_SIZE:r.size},e.id)},t.isOverQuotaError=function(e){return!(!e||"over_quota_error"!==e[".tag"])},t.isFilesystemError=function(e){return!(!e||"filesystem_error"!==e[".tag"])},t.isUnsupportedFileError=function(e){return!(!e||"unsupported_file_error"!==e[".tag"])},t.isUnauthorizedAccessError=function(e){return!(!e||"unauthorized_access"!==e[".tag"])}})),define("modules/clean/react/workflows/markup/fabric_wrapper",["require","exports","tslib","fabric"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(n=r.__importDefault(n)).default.fabric||n.default;t.fabric=a})),define("modules/clean/react/workflows/markup/fabric",["require","exports","tslib","modules/clean/react/workflows/markup/fabric_wrapper","modules/clean/previews/constants","modules/clean/react/workflows/markup/types","modules/clean/api_v2/user_client"],(function(e,t,r,n,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});n.fabric.Object&&(n.fabric.util.object.extend(n.fabric.Object.prototype,{cornerStyle:"circle",cornerColor:"#0052D9",cornerSize:10,cornerStrokeColor:"white",transparentCorners:!1,drawControls:function(e,t){t=t||{};var r=this._calculateCurrentDimensions(),n=r.x,a=r.y,i=t.cornerSize||this.cornerSize,o=-(n+i)/2,s=-(a+i)/2,c=void 0!==t.transparentCorners?t.transparentCorners:this.transparentCorners,l=void 0!==t.hasRotatingPoint?t.hasRotatingPoint:this.hasRotatingPoint,u=c?"stroke":"fill";return e.save(),e.strokeStyle=e.fillStyle=t.cornerColor||this.cornerColor,this.transparentCorners||(e.strokeStyle=t.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(e,t.cornerDashArray||this.cornerDashArray,null),this._drawControl("tl",e,u,o,s,t),this._drawControl("tr",e,u,o+n,s,t),this._drawControl("bl",e,u,o,s+a,t),this._drawControl("br",e,u,o+n,s+a,t),l&&this._drawControl("mtr",e,u,o+n/2,s-this.rotatingPointOffset,t),e.restore(),this},_findTargetCorner:function(e){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var t=e.x,r=e.y;for(var n in this.__corner=0,this.oCoords)if(this.isControlVisible(n)&&("mtr"!==n||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==n&&"mr"!==n&&"mb"!==n&&"ml"!==n)){var a=void 0;switch(n){case"mt":a=this._getHorizontalImageLines(this.oCoords.tl.corner,this.oCoords.tr.corner);break;case"mr":a=this._getVerticalImageLines(this.oCoords.tr.corner,this.oCoords.br.corner);break;case"mb":a=this._getHorizontalImageLines(this.oCoords.bl.corner,this.oCoords.br.corner);break;case"ml":a=this._getVerticalImageLines(this.oCoords.tl.corner,this.oCoords.bl.corner);break;default:a=this._getImageLines(this.oCoords[n].corner)}var i=this._findCrossPoints({x:t,y:r},a);if(0!==i&&i%2==1)return this.__corner=n,n}return!1},_getHorizontalImageLines:function(e,t){return{topline:{o:e.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_getVerticalImageLines:function(e,t){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:e.tl}}}}),n.fabric.util.object.extend(n.fabric.Canvas.prototype,{uniScaleKey:null,_getActionFromCorner:function(e,t,r){if(!t||!e)return"drag";switch(t){case"mtr":return"rotate";case"ml":case"mr":return r.shiftKey?"scale":"scaleX";case"mt":case"mb":return r.shiftKey?"scale":"scaleY";default:return"scale"}}})),n.fabric.BaseBrush&&(c(i.MarkupColor.RED_CHERRY),n.fabric.BaseBrush.prototype.width=3);var s={strokeUniform:!0,strokeWidth:3,stroke:"red"};function c(e){n.fabric.BaseBrush&&(n.fabric.BaseBrush.prototype.color=e)}function l(e){return e&&"group"===e.type}function u(e){return e&&"i-text"===e.type}t.addMarkupObject=function(e,t,a){var o;switch(t){case i.MarkupType.TEXT:o=new n.fabric.IText("Text",r.__assign(r.__assign(r.__assign(r.__assign({},s),{fontSize:22}),a),{fill:a.stroke,stroke:void 0}));break;case i.MarkupType.CIRCLE:o=new n.fabric.Circle(r.__assign(r.__assign(r.__assign({},s),{radius:50,fill:void 0}),a));break;case i.MarkupType.RECT:o=new n.fabric.Rect(r.__assign(r.__assign(r.__assign({},s),{width:100,height:100,fill:void 0}),a));break;case i.MarkupType.ARROW:var c=a.left,l=a.top,u=a.stroke,d=[c,l+100,c+100,l],p=180*Math.atan2(100,100)/Math.PI,m=new n.fabric.Triangle(r.__assign(r.__assign({},s),{angle:p,top:d[3],left:d[2]+3,height:15,width:15,originX:"center",originY:"center",stroke:u,fill:u})),_=new n.fabric.Line(d,r.__assign(r.__assign({},s),a));o=new n.fabric.Group([_,m],r.__assign(r.__assign(r.__assign({},s),{lockUniScaling:!0,centeredScaling:!0}),a))}o&&(e.add(o),e.setActiveObject(o))},t.setDrawingMode=function(e,t){for(var r in e)if(e.hasOwnProperty(r)&&"object"==typeof e[r]){var n=e[r].fabric;n&&(n.isDrawingMode=t)}},t.setBaseBrushColor=c,t.disposeCanvas=function(e){for(var t in e)e[t].fabric&&e[t].fabric.dispose()},t.saveMarkup=function(e,t,n,i,s){return r.__awaiter(this,void 0,void 0,(function(){var c,l,u,d,p,m,_,g,f,v,h,w;return r.__generator(this,(function(r){for(d in c=new o.UserApiV2Client,l=[],u=s===a.PreviewType.SsrDoc?300/72:1,i)if(i.hasOwnProperty(d)&&"object"==typeof i[d]&&(p=i[d].scale,m=u/p,_=i[d].fabric))for(g=0,f=_.getObjects();g<f.length;g++)v=f[g],h=v.getBoundingRect(),l.push({".tag":"burn_image",image:v.toDataURL({multiplier:m}).split(",",2).pop(),x:Math.round(h.left/p),y:Math.round(h.top/p),page:Number(d)});return w={path:t,should_overwrite:n,burn_objects:l},[2,c.ns("workflows").rpc("markup_file",w,{subjectUserId:e})]}))}))},t.setOptionsForActiveObjects=function(e,t){e&&(e.getActiveObjects().forEach((function(e){u(e)?e.set(r.__assign(r.__assign({},t),{stroke:void 0,fill:t.stroke||e.fill})):l(e)?e.forEachObject((function(e){return e.set(r.__assign(r.__assign({},t),{fill:t.stroke||e.stroke}))})):!(function(e){return e&&"path"===e.type})(e)?e.set(t):e.set(r.__assign(r.__assign({},t),{fill:void 0}))})),e.renderAll())},t.getStroke=function(e){return u(e)?e.fill:l(e)?e.getObjects().filter((function(e){return"line"===e.type}))[0].stroke:"stroke"in e?e.stroke:void 0},t.getFill=function(e){if((function(e){return e&&"circle"===e.type})(e)||(function(e){return e&&"rect"===e.type})(e))return e.fill}})),define("modules/clean/react/workflows/markup/selectors",["require","exports","modules/clean/react/file_viewer/data/selectors"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMarkupState=function(e){return r.getFileViewerState(e).markup}})),define("modules/clean/react/workflows/markup/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e[e.TEXT=0]="TEXT",e[e.CIRCLE=1]="CIRCLE",e[e.RECT=2]="RECT",e[e.ARROW=3]="ARROW",e[e.FREEFORM=4]="FREEFORM"})(t.MarkupType||(t.MarkupType={})),(function(e){e.STROKE="stroke",e.FILL="fill"})(t.FormatSubmenuEntry||(t.FormatSubmenuEntry={})),(function(e){e.TRANSPARENT="transparent",e.RED_CHERRY="#D62C0B",e.ORANGE_TANGERINE="#FF8E21",e.GREEN="#00864C",e.DARK_BLUE="#005DD6",e.ULTRAVIOLET="#813BF6",e.WHITE="white",e.BLACK="black"})(t.MarkupColor||(t.MarkupColor={}))})),define("modules/clean/react/workflows/markup/utils",["require","exports","modules/constants/file_viewer","modules/clean/file_store/utils","modules/clean/previews/constants","modules/core/i18n","modules/clean/react/workflows/markup/types"],(function(e,t,r,n,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=[".pdf",".jpg",".jpeg",".png",".bmp"];t.OFFSET=10,t.DEFAULT_LEFT=100,t.DEFAULT_TOP=100,t.MOVE_DISTANCE_X=1,t.MOVE_DISTANCE_Y=1,t.fileIsMarkupable=function(e){return!!e&&(n.isBrowseFile(e)&&!e.read_only&&!!e.ext&&s.includes(e.ext.toLowerCase()))};t.userCanMarkup=function(){return["M0"].includes(r.FILE_MARKUP)},t.allowMarkup=function(e){return t.userCanMarkup()&&t.fileIsMarkupable(e)},t.getMarkupLabelText=function(e,t){if(e)return t===a.PreviewType.Image?i._("Markup is available on PDFs, PNGs, JPEGs, and BMPs."):i._("Markup is available on PDFs and images.")},t.getMarkupErrorMessage=function(e){switch(e[".tag"]){case"over_quota_error":return i._("Can’t save because your account is full. Upgrade to get more space.");case"filesystem_error":return i._("Couldn’t save markup. Refresh the page to try again.");case"unsupported_file_error":return i._("Can’t save. Markup isn’t available for this file type.");case"unauthorized_access":return i._("You don’t have permission to save to this folder.");default:return i._("Couldn’t save markup. Refresh the page to try again.")}},t.DEFAULT_MARKUP_STATE={isDrawingMode:!1,formatSubmenu:[],strokeColor:o.MarkupColor.RED_CHERRY,fillColor:o.MarkupColor.TRANSPARENT}})),define("modules/clean/react/user_metadata/api",["require","exports","modules/clean/api_v2/user_client","modules/clean/react/user_metadata/util"],(function(e,t,r,n){"use strict";function a(e){var t=n.removeEmptyFields(e),r=n.getUserMetadataKeys(t),a={};return r.forEach((function(e){a[e]=JSON.stringify(t[e])})),a}function i(e){var t=n.getUserMetadataKeys(e.metadata),r={};return t.forEach((function(t){var n=JSON.parse(e.metadata[t]);null!=n&&(r[t]=n)})),r}function o(e,t){return(new r.UserApiV2Client).ns("user_metadata").rpc("user_metadata/get",e,{subjectUserId:t})}function s(e,t){return(new r.UserApiV2Client).ns("user_metadata").rpc("user_metadata/set",e,{subjectUserId:t})}Object.defineProperty(t,"__esModule",{value:!0}),t.getUserMetadata=function(e,t){return o({metadata:e},t).then(i)},t.setUserMetadata=function(e,t){return s({metadata:a(e)},t).then(i)},t.prepareUserMetadataSetArg=a,t.processUserMetadataResult=i,t.fetchUserMetadata=o,t.mutateUserMetadata=s})),define("modules/clean/react/user_metadata/util",["require","exports"],(function(e,t){"use strict";function r(e){return Object.keys(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.pickMetadata=function(e,t){var r={};return e.forEach((function(e){r[e]=t[e]})),r},t.removeEmptyFields=function(e){var t=r(e),n={};return t.forEach((function(t){null!=e[t]&&(n[t]=e[t])})),n},t.getUserMetadataKeys=r})),define("modules/clean/react/previews/preview_toolbar_button",["require","exports","tslib","classnames","react","modules/clean/react/sprite","modules/clean/static_urls","spectrum/icon_document","spectrum/tooltip"],(function(e,t,r,n,a,i,o,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),a=r.__importDefault(a),t.PreviewToolbarButton=function(e){var t=e.className,r=e["data-test"],l=e.disabled,u=e.iconName,d=e.onClick,p=e.spriteGroup,m=e.spriteName,_=e.spectrumIconName,g=e.tooltip;return a.default.createElement("div",{className:n.default(t,"toolbar-button-entry"),"data-test":r},a.default.createElement(c.Tooltip,{positioning:"above",positionOffset:24,tooltipContent:g},a.default.createElement("button",{className:t+"-button","aria-label":g,onClick:d},void 0!==u?a.default.createElement("img",{src:o.static_url("/static/images/previews/toolbar/"+u+".svg"),alt:g,className:n.default({disabled:l})}):void 0!==m?a.default.createElement(i.Sprite,{group:p,name:m,alt:g,className:n.default({disabled:l})}):a.default.createElement(s.IconDocument,{name:_}))))}})),define("spectrum/icon_document",["require","exports","tslib","react","spectrum/icon_templates/stateless","spectrum/svg_icon_bundle","spectrum/icon_document/bundle"],(function(e,t,r,n,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.ICONS=o.ICONS,t.IconDocument=function(e){var t=e.name,r=n.createElement(i.SvgIconBundle,{focusable:"false",icon:o.ICONS[t]});return n.createElement(a.Component,Object.assign({icon:r},e))},t.IconDocument.displayName="IconDocument"})),define("spectrum/icon_document/bundle",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ICONS=JSON.parse('\n    {"date-small":{"attrs":{"width":"24","height":"24","viewBox":"0 0 24 24"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#000\\" fill-rule=\\"nonzero\\"><path d=\\"M4 4h16v16H4V4zm2 2v12h12V6H6z\\"></path><path d=\\"M5 8h14v2H5zM7 2h2v4H7zM15 2h2v4h-2z\\"></path></g></g>"},"date":{"attrs":{"width":"32","height":"32","viewBox":"0 0 32 32"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#000\\" fill-rule=\\"nonzero\\"><path d=\\"M6 6h20v20H6V6zm2 2v16h16V8H8z\\"></path><path d=\\"M7 11h18v2H7zM11 4h2v4h-2zM19 4h2v4h-2z\\"></path></g></g>"},"signature-small":{"attrs":{"width":"24","height":"24","viewBox":"0 0 24 24"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#000\\" fill-rule=\\"nonzero\\"><path d=\\"M1 18h22v1H1z\\"></path><path d=\\"M10.874 17.262c-1.33 1.046-1.25 2.246-.297 2.723 1.076.537 2.438-.321 3.206-2.953.226-.774.42-1.509.583-2.205-1.06.632-2.251 1.46-3.492 2.435zm4.589.26c-1.044 3.578-3.487 5.118-5.668 4.028-2.131-1.065-2.317-3.844-.003-5.664 1.857-1.46 3.565-2.6 5.014-3.317.634-4.207-.218-6.501-2.436-6.681-1.374-.111-1.993.459-2.027 1.713-.041 1.48.799 3.57 2.34 5.61l-1.397 1.054c-1.76-2.33-2.746-4.782-2.693-6.713.062-2.246 1.534-3.602 3.918-3.408 3.355.272 4.634 3.065 4.144 7.711 1.236-.31 2.137-.102 2.578.742.211.404.28.842.24 1.308a3.4 3.4 0 0 1-.025.205c1.118-.989 1.885-1.388 2.896-1.103.22.063.432.163.632.299l-.986 1.446a.42.42 0 0 0-.121-.06c-.223-.063-.618.152-1.332.792l-.42.379c-.17.151-.308.267-.442.37-.42.32-.786.5-1.217.5-.758 0-1.248-.545-1.188-1.264a2.4 2.4 0 0 1 .12-.543c.034-.105.181-.524.157-.454.11-.32.166-.532.182-.719a.652.652 0 0 0-.037-.325c.02.04.003.044-.143.053-.287.018-.69.127-1.183.324a38.652 38.652 0 0 1-.903 3.717zM1.381 11.619L2.62 10.38l4.95 4.95-1.238 1.237z\\"></path><path d=\\"M6.377 10.382l1.238 1.236-4.948 4.952-1.238-1.237z\\"></path></g></g>"},"signature":{"attrs":{"width":"32","height":"32","viewBox":"0 0 32 32"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#000\\" fill-rule=\\"nonzero\\"><path d=\\"M3 24h26v1H3z\\"></path><path d=\\"M12.5 23.31c-1.983 1.56-1.857 3.437-.376 4.177 1.643.821 3.682-.464 4.79-4.26.37-1.271.68-2.47.931-3.594-1.6.917-3.43 2.172-5.345 3.678zm6.334.476c-1.423 4.878-4.698 6.942-7.604 5.49-2.828-1.413-3.075-5.094.034-7.538 2.627-2.065 5.04-3.666 7.065-4.65.94-6.089-.293-9.445-3.584-9.712-2.047-.166-3.02.73-3.072 2.607-.058 2.126 1.133 5.09 3.313 7.976l-1.595 1.206c-2.431-3.218-3.79-6.597-3.717-9.237.082-3.012 2.03-4.805 5.233-4.546 4.596.373 6.315 4.295 5.547 10.86 1.785-.52 3.073-.3 3.663.83.273.523.363 1.094.31 1.705a4.971 4.971 0 0 1-.175.925c.12-.105.252-.223.4-.356 1.565-1.402 2.605-1.969 3.947-1.59.285.08.558.21.818.387l-1.126 1.652a.807.807 0 0 0-.235-.114c-.414-.117-1.015.21-2.07 1.155-.07.063-.47.426-.586.529a10.64 10.64 0 0 1-.604.506c-.55.42-1.024.653-1.565.653-.928 0-1.51-.649-1.437-1.524.018-.219.07-.436.158-.71.046-.143.25-.725.217-.63.16-.462.24-.774.265-1.057.023-.255-.008-.449-.09-.605-.063-.122-.828-.083-2.231.498-.3 1.634-.728 3.4-1.279 5.29z\\"></path><path d=\\"M8.293 14.294l1.415 1.414-4.997 5-1.414-1.414z\\"></path><path d=\\"M3.297 15.708l1.414-1.414 5 5-1.414 1.414z\\"></path></g></g>"},"text-small":{"attrs":{"width":"24","height":"24","viewBox":"0 0 24 24"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#000\\" fill-rule=\\"nonzero\\"><path d=\\"M4 4h16v16H4V4zm2 2v12h12V6H6z\\"></path><path d=\\"M8 8h8v2H8z\\"></path><path d=\\"M11 9h2v7h-2z\\"></path></g></g>"},"text":{"attrs":{"width":"32","height":"32","viewBox":"0 0 32 32"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#000\\" fill-rule=\\"nonzero\\"><path d=\\"M6 6h20v20H6V6zm2 2v16h16V8H8z\\"></path><path d=\\"M11 11h10v2H11zM15 13h2v8h-2z\\"></path></g></g>"}}\n  ')}));
//# sourceMappingURL=pkg-shared_link_core.min.js-vfl8vN487.map