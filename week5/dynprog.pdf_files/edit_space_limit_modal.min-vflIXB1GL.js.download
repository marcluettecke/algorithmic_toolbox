define(["require","exports","tslib","react","spectrum/button","spectrum/input","spectrum/modal","modules/clean/react/css","modules/clean/react/modal","modules/clean/static_urls","modules/clean/teams/admin/api/admin_console_api_client","modules/clean/teams/components/warning_box","modules/core/browser","modules/core/i18n","modules/core/notify"],(function(e,t,i,a,s,n,o,r,l,m,u,c,d,p,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=i.__importDefault(a),u=i.__importDefault(u),d=i.__importStar(d);var h=p._("GB"),C=p._("Reset custom space limit"),g=p._("This member might be out of space if you set a limit lower than their current usage."),y=a.default.createElement("div",null,a.default.createElement("div",{className:"off-warning-message"},p.intl.formatMessage(p._("To apply a custom space limit, you’ll need to set a member space limit for your team first. <a>View settings</a>"),{a:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a.default.createElement("a",{href:"/team/admin/settings/space",target:"_blank",rel:"noopener noreferrer"},e)}})),g),_=(function(e){function t(t){var i=e.call(this,t)||this;return i.setCustomQuota=function(){return i._client.setCustomQuota(i.props.email,i.state.customQuota)},i.resetCustomQuota=function(){return i._client.removeCustomQuota(i.props.email)},i.onSet=function(){null==i.state.customQuota||i.state.customQuota<15?f.Notify.error(p._("Custom quota must exceed 15 GB")):i.onSubmit(i.setCustomQuota)},i.onMainCancelClicked=function(){i.setState({isModalOpen:!1,isResetConfirmationOpen:!1})},i.onResetCancel=function(){i.setState({isModalOpen:!0,isResetConfirmationOpen:!1})},i.onReset=function(){i.onSubmit(i.resetCustomQuota)},i.primaryAction=function(e,t,n){return a.default.createElement("span",null,i.state.submitting&&a.default.createElement("span",{className:"dbmodal-loading",key:"loading"},a.default.createElement("img",{src:m.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:p._("Loading")})),a.default.createElement(s.Button,{disabled:i.state.submitting||n,variant:"primary",onClick:t},e))},i.setPrimaryAction=function(e){var t="Set custom space limit";return i.props.userCustomLimitGB&&(t=p.intl.formatMessage(p._("Set %(first_name)s’s space limit"),{first_name:i.firstName})),i.primaryAction(t,e,!i.isValidInput())},i.resetPrimaryAction=function(e){return i.primaryAction(p._("Reset custom space limit"),e,!1)},i.secondaryAction=function(e){return a.default.createElement(s.Button,{disabled:i.state.submitting,variant:"secondary",onClick:e},p._("Cancel"))},i.saveCustomQuotaChange=function(e){i.setState({customQuota:Number(e.currentTarget.value)})},i.onResetClicked=function(){i.setState({isModalOpen:!1,isResetConfirmationOpen:!0})},i.state={submitting:!1,isModalOpen:!0,customQuota:i.props.userCustomLimitGB,isResetConfirmationOpen:!1},i._client=new u.default,i}return i.__extends(t,e),t.prototype.getErrorMessage=function(){return null==this.state.customQuota?null:this.state.customQuota%1!=0?p._("This must be a whole number"):this.state.customQuota<15?p._("This number can’t be lower than 15"):null},t.prototype.isValidInput=function(){return null!=this.state.customQuota&&this.state.customQuota!==this.props.userCustomLimitGB&&15<=this.state.customQuota&&this.state.customQuota%1==0},t.prototype.onSubmit=function(e){var t=this;this.setState({submitting:!0}),e().then((function(){t.setState({submitting:!1,isModalOpen:!1}),t.props.redirectOnChangeUrl?d.redirect(t.props.redirectOnChangeUrl+"&msg=cq_set"):d.reload()})).catch((function(){t.setState({submitting:!1}),t.props.redirectOnChangeUrl?d.redirect(t.props.redirectOnChangeUrl+"&msg=cq_failed"):d.reload()}))},t.prototype.renderMainModal=function(){var e,t,i=p.intl.formatMessage(p._("Edit %(display_name)s’s space limit"),{display_name:this.displayName}),s=p.intl.formatMessage(p._("Set a custom space limit for this member. %(first_name)s is currently using %(usage)s."),{first_name:this.firstName,usage:this.props.userUsageString}),r=this.props.userCustomLimitGB?C:void 0,l=this.getErrorMessage(),m="off"===this.props.teamCapsType?y:g;return a.default.createElement(o.UtilityModal,{className:"edit-space-limit-modal",overlayClassName:"edit-space-limit-modal--overlay",title:i,primaryAction:this.setPrimaryAction,secondaryAction:this.secondaryAction,link:r,onPrimaryAction:this.onSet,onSecondaryAction:this.onMainCancelClicked,onLink:this.onResetClicked,onRequestClose:this.onMainCancelClicked,overlayClickClose:!0,ariaLabel:p._("Set custom space limit"),open:this.state.isModalOpen&&!this.state.isResetConfirmationOpen},a.default.createElement("div",{className:"edit-space-limit-content"},s,a.default.createElement("br",null)),a.default.createElement("div",{className:"space-limit-row"},a.default.createElement("label",{className:"limit-label",htmlFor:"team-limit-input"},p._("Everyone’s default limit"),a.default.createElement("br",null),(e=!!this.props.userCustomLimitGB,t=p._("edit everyone’s default"),e&&(t=p._("edit")),a.default.createElement("a",{href:"/team/admin/settings/space",target:"_blank",rel:"noopener noreferrer"},t))),a.default.createElement("div",{className:"limit-input"},a.default.createElement(n.Input,{id:"team-limit-input",defaultValue:String(this.props.teamMemberDefaultLimitGB),disabled:!0}),a.default.createElement("div",{className:"limit-suffix"},h))),a.default.createElement("div",{className:"space-limit-row space-limit-input-row"},a.default.createElement("label",{className:"limit-label",htmlFor:"user-limit-input"},p._("This member’s limit"),a.default.createElement("br",null),p._("(must exceed 15 GB)")),a.default.createElement("div",{className:"limit-value"},a.default.createElement("div",{className:"limit-input"},a.default.createElement(n.Input,{id:"user-limit-input",type:"number",min:15,defaultValue:String(this.props.userCustomLimitGB),onChange:this.saveCustomQuotaChange}),a.default.createElement("div",{className:"limit-suffix"},h)),a.default.createElement("div",{className:"limit-error"},l))),a.default.createElement(c.WarningBox,{warningText:m}))},t.prototype.renderResetConfirmationModal=function(){var e=p._("Reset custom space limit"),t=p._("This member’s limit will return to the default space limit.");return a.default.createElement(o.UtilityModal,{className:"edit-space-limit-modal",overlayClassName:"edit-space-limit-modal--overlay",title:e,primaryAction:this.resetPrimaryAction,secondaryAction:this.secondaryAction,onPrimaryAction:this.onReset,onSecondaryAction:this.onResetCancel,onRequestClose:this.onMainCancelClicked,overlayClickClose:!0,ariaLabel:p._("Reset custom space limit"),open:this.state.isResetConfirmationOpen},a.default.createElement("div",{className:"edit-space-limit-content"},t))},t.prototype.render=function(){return this.state.isResetConfirmationOpen?this.renderResetConfirmationModal():this.renderMainModal()},Object.defineProperty(t.prototype,"displayName",{get:function(){return this.props.displayName||this.props.email},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstName",{get:function(){return this.props.firstName||this.props.email},enumerable:!0,configurable:!0}),t})(a.default.Component);t.EditSpaceLimitModal=r.requireCssWithComponent(_,["/static/css/spectrum/index.web-vfl_-DzRS.css","/static/css/teams/edit_space_limit_modal-vflIXZzu2.css"]),t.showEditSpaceLimitModal=function(e){l.Modal.showInstance(a.default.createElement(t.EditSpaceLimitModal,i.__assign({},e)))}}));
//# sourceMappingURL=edit_space_limit_modal.min.js-vflcuARFz.map